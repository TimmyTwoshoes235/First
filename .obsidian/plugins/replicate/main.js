/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/
"use strict";var lu=Object.create;var Pr=Object.defineProperty;var uu=Object.getOwnPropertyDescriptor;var cu=Object.getOwnPropertyNames;var fu=Object.getPrototypeOf,du=Object.prototype.hasOwnProperty;var qt=(n,r)=>()=>(n&&(r=n(n=0)),r);var x=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports),Fi=(n,r)=>{for(var o in r)Pr(n,o,{get:r[o],enumerable:!0})},Wi=(n,r,o,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of cu(r))!du.call(n,a)&&a!==o&&Pr(n,a,{get:()=>r[a],enumerable:!(s=uu(r,a))||s.enumerable});return n};var Ce=(n,r,o)=>(o=n!=null?lu(fu(n)):{},Wi(r||!n||!n.__esModule?Pr(o,"default",{value:n,enumerable:!0}):o,n)),hu=n=>Wi(Pr({},"__esModule",{value:!0}),n);var Fr=x((zf,Ji)=>{"use strict";var eo=class extends Error{constructor(r,o,s){super(r),this.name="ApiError",this.request=o,this.response=s}};Ji.exports=eo});var Xi=x((xf,Zi)=>{"use strict";var to=class n{constructor(r,o,s=null){this.owner=r,this.name=o,this.version=s}static parse(r){let o=r.match(/^(?<owner>[^/]+)\/(?<name>[^/:]+)(:(?<version>.+))?$/);if(!o)throw new Error(`Invalid reference to model version: ${r}. Expected format: owner/name or owner/name:version`);let{owner:s,name:a,version:u}=o.groups;return new n(s,a,u)}};Zi.exports=to});var ro=x(($f,es)=>{"use strict";async function vu(n,r={}){let o=new FormData,s,a;if(n instanceof Blob)s=n.name||`blob_${Date.now()}`,a=n;else if(Buffer.isBuffer(n)){s=`buffer_${Date.now()}`;let f=new Uint8Array(n);a=new Blob([f],{type:"application/octet-stream",name:s})}else throw new Error("Invalid file argument, must be a Blob, File or Buffer");return o.append("content",a,s),o.append("metadata",new Blob([JSON.stringify(r)],{type:"application/json"})),(await this.request("/files",{method:"POST",data:o,headers:{"Content-Type":"multipart/form-data"}})).json()}async function Ou(){return(await this.request("/files",{method:"GET"})).json()}async function ku(n){return(await this.request(`/files/${n}`,{method:"GET"})).json()}async function Bu(n){return(await this.request(`/files/${n}`,{method:"DELETE"})).status===204}es.exports={create:vu,list:Ou,get:ku,delete:Bu}});var xt=x((jf,ss)=>{"use strict";var ns=Fr(),{create:Iu}=ro();async function Du(n,r){let{id:o,timestamp:s,body:a,signature:u}=n,f=r||n.secret;if(n&&n.headers&&n.body&&(o=n.headers.get("webhook-id"),s=n.headers.get("webhook-timestamp"),u=n.headers.get("webhook-signature"),a=n.body),a instanceof ReadableStream||a.readable)try{a=await new Response(a).text()}catch(b){throw new Error(`Error reading body: ${b.message}`)}else if(is(a))a=await new Blob([a]).text();else if(typeof a!="string")throw new Error("Invalid body type");if(!o||!s||!u)throw new Error("Missing required webhook headers");if(!a)throw new Error("Missing required body");if(!f)throw new Error("Missing required secret");let y=`${o}.${s}.${a}`,m=await qu(f.split("_").pop(),y);return u.split(" ").map(b=>b.split(",")[1]).some(b=>b===m)}async function qu(n,r){let o=new TextEncoder,s=globalThis.crypto;typeof s>"u"&&typeof require=="function"&&(s=require.call(null,"node:crypto").webcrypto);let a=await s.subtle.importKey("raw",Fu(n),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),u=await s.subtle.sign("HMAC",a,o.encode(r));return os(u)}function Fu(n){return Uint8Array.from(atob(n),r=>r.codePointAt(0))}function os(n){return btoa(String.fromCharCode.apply(null,new Uint8Array(n)))}async function Wu(n,r={}){let o=r.shouldRetry||(()=>!1),s=r.maxRetries||5,a=r.interval||500,u=r.jitter||100,f=m=>new Promise(h=>setTimeout(h,m)),y=0;do{let m=a*2**y+Math.random()*u;try{let h=await n();if(h.ok||!o(h))return h}catch(h){if(h instanceof ns){let b=h.response.headers.get("Retry-After");if(b)if(Number.isInteger(b))m=b*1e3;else{let O=new Date(b);Number.isNaN(O.getTime())||(m=O.getTime()-new Date().getTime())}}}Number.isInteger(s)&&s>0&&(Number.isInteger(m)&&m>0&&await f(a*2**(r.maxRetries-s)),y+=1)}while(y<s);return n()}async function Mu(n,r,o){switch(o){case"data-uri":return await rs(n,r);case"upload":return await ts(n,r);case"default":try{return await ts(n,r)}catch(s){if(s instanceof ns&&s.response.status>=400&&s.response.status<500)throw s;return await rs(r)}default:throw new Error(`Unexpected file upload strategy: ${o}`)}}async function ts(n,r){return await Wr(r,async o=>o instanceof Blob||o instanceof Buffer?(await Iu.call(n,o)).urls.get:o)}var Lu=1e7;async function rs(n){let r=0;return await Wr(n,async o=>{let s,a;if(o instanceof Blob)s=await o.arrayBuffer(),a=o.type;else if(is(o))s=o;else return o;if(r+=s.byteLength,r>Lu)throw new Error(`Combined filesize of prediction ${r} bytes exceeds 10mb limit for inline encoding, please provide URLs instead`);let u=os(s);return a=a??"application/octet-stream",`data:${a};base64,${u}`})}async function Wr(n,r){if(Array.isArray(n)){let o=[];for(let s of n){let a=await Wr(s,r);o.push(a)}return o}if(zu(n)){let o={};for(let s of Object.keys(n))o[s]=await Wr(n[s],r);return o}return await r(n)}function is(n){return n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Uint16Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array}function zu(n){if(!(typeof n=="object"&&n!==null)||String(n)!=="[object Object]")return!1;let o=Object.getPrototypeOf(n);if(o===null)return!0;let s=Object.prototype.hasOwnProperty.call(o,"constructor")&&o.constructor;return typeof s=="function"&&s instanceof s&&Function.prototype.toString.call(s)===Function.prototype.toString.call(Object)}function xu(n){let r=typeof n=="object"&&n.logs?n.logs:n;if(!r||typeof r!="string")return null;let o=/^\s*(\d+)%\s*\|.+?\|\s*(\d+)\/(\d+)/,s=r.split(`
`).reverse();for(let a of s){let u=a.match(o);if(u&&u.length===4)return{percentage:parseInt(u[1],10)/100,current:parseInt(u[2],10),total:parseInt(u[3],10)}}return null}async function*$u(n){let r=n.getReader();try{for(;;){let{done:o,value:s}=await r.read();if(o)return;yield s}}finally{r.releaseLock()}}ss.exports={transformFileInputs:Mu,validateWebhook:Du,withAutomaticRetries:Wu,parseProgressFromLogs:xu,streamAsyncIterator:$u}});var cs=x((Nf,us)=>{"use strict";var no=Object.defineProperty,ju=Object.getOwnPropertyDescriptor,Nu=Object.getOwnPropertyNames,Uu=Object.prototype.hasOwnProperty,Hu=(n,r)=>{for(var o in r)no(n,o,{get:r[o],enumerable:!0})},Gu=(n,r,o,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of Nu(r))!Uu.call(n,a)&&a!==o&&no(n,a,{get:()=>r[a],enumerable:!(s=ju(r,a))||s.enumerable});return n},Vu=n=>Gu(no({},"__esModule",{value:!0}),n),as={};Hu(as,{EventSourceParserStream:()=>Ku});us.exports=Vu(as);function Yu(n){let r,o,s,a,u,f,y;return m(),{feed:h,reset:m};function m(){r=!0,o="",s=0,a=-1,u=void 0,f=void 0,y=""}function h(O){o=o?o+O:O,r&&Qu(o)&&(o=o.slice(ls.length)),r=!1;let E=o.length,P=0,g=!1;for(;P<E;){g&&(o[P]===`
`&&++P,g=!1);let v=-1,w=a,R;for(let D=s;v<0&&D<E;++D)R=o[D],R===":"&&w<0?w=D-P:R==="\r"?(g=!0,v=D-P):R===`
`&&(v=D-P);if(v<0){s=E-P,a=w;break}else s=0,a=-1;b(o,P,w,v),P+=v+1}P===E?o="":P>0&&(o=o.slice(P))}function b(O,E,P,g){if(g===0){y.length>0&&(n({type:"event",id:u,event:f||void 0,data:y.slice(0,-1)}),y="",u=void 0),f=void 0;return}let v=P<0,w=O.slice(E,E+(v?g:P)),R=0;v?R=g:O[E+P+1]===" "?R=P+2:R=P+1;let D=E+R,$=g-R,B=O.slice(D,D+$).toString();if(w==="data")y+=B?"".concat(B,`
`):`
`;else if(w==="event")f=B;else if(w==="id"&&!B.includes("\0"))u=B;else if(w==="retry"){let F=parseInt(B,10);Number.isNaN(F)||n({type:"reconnect-interval",value:F})}}}var ls=[239,187,191];function Qu(n){return ls.every((r,o)=>n.charCodeAt(o)===r)}var Ku=class extends TransformStream{constructor(){let n;super({start(r){n=Yu(o=>{o.type==="event"&&r.enqueue(o)})},transform(r){n.feed(r)}})}}});var hs=x((Vf,ds)=>{"use strict";var io=Object.defineProperty,Ju=Object.getOwnPropertyDescriptor,Zu=Object.getOwnPropertyNames,Xu=Object.prototype.hasOwnProperty,ec=(n,r)=>{for(var o in r)io(n,o,{get:r[o],enumerable:!0})},tc=(n,r,o,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of Zu(r))!Xu.call(n,a)&&a!==o&&io(n,a,{get:()=>r[a],enumerable:!(s=Ju(r,a))||s.enumerable});return n},rc=n=>tc(io({},"__esModule",{value:!0}),n),fs={};ec(fs,{TextDecoderStream:()=>oc});ds.exports=rc(fs);var Mr=Symbol("decDecoder"),oo=Symbol("decTransform"),nc=class{constructor(n){this.decoder_=n}transform(n,r){if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new TypeError("Input data must be a BufferSource");let o=this.decoder_.decode(n,{stream:!0});o.length!==0&&r.enqueue(o)}flush(n){let r=this.decoder_.decode();r.length!==0&&n.enqueue(r)}},oc=class{constructor(n,r){let o=new TextDecoder(n||"utf-8",r||{});this[Mr]=o,this[oo]=new TransformStream(new nc(o))}get encoding(){return this[Mr].encoding}get fatal(){return this[Mr].fatal}get ignoreBOM(){return this[Mr].ignoreBOM}get readable(){return this[oo].readable}get writable(){return this[oo].writable}},Hf=Symbol("encEncoder"),Gf=Symbol("encTransform")});var ms=x((Kf,ps)=>{"use strict";var ic=Fr(),{streamAsyncIterator:sc}=xt(),{EventSourceParserStream:ac}=cs(),{TextDecoderStream:lc}=typeof globalThis.TextDecoderStream>"u"?hs():globalThis,Lr=class{constructor(r,o,s,a){this.event=r,this.data=o,this.id=s,this.retry=a}toString(){return this.event==="output"?this.data:""}};function uc({url:n,fetch:r,options:o={}}){return new ReadableStream({async start(s){let a={...o,headers:{...o.headers,Accept:"text/event-stream"}},u=await r(n,a);if(!u.ok){let y=await u.text(),m=new Request(n,a);s.error(new ic(`Request to ${n} failed with status ${u.status}: ${y}`,m,u))}let f=u.body.pipeThrough(new lc).pipeThrough(new ac);for await(let y of sc(f)){if(y.event==="error"){s.error(new Error(y.data));break}if(s.enqueue(new Lr(y.event,y.data,y.id)),y.event==="done")break}s.close()}})}ps.exports={createReadableStream:uc,ServerSentEvent:Lr}});var ys=x((Jf,bs)=>{"use strict";async function cc(){return(await this.request("/account",{method:"GET"})).json()}bs.exports={current:cc}});var _s=x((Zf,gs)=>{"use strict";async function fc(n){return(await this.request(`/collections/${n}`,{method:"GET"})).json()}async function dc(){return(await this.request("/collections",{method:"GET"})).json()}gs.exports={get:fc,list:dc}});var Ss=x((Xf,ws)=>{"use strict";var{transformFileInputs:hc}=xt();async function pc(n,r,o){let{stream:s,input:a,...u}=o;if(u.webhook)try{new URL(u.webhook)}catch{throw new Error("Invalid webhook URL")}return(await this.request(`/deployments/${n}/${r}/predictions`,{method:"POST",data:{...u,input:await hc(this,a,this.fileEncodingStrategy),stream:s}})).json()}async function mc(n,r){return(await this.request(`/deployments/${n}/${r}`,{method:"GET"})).json()}async function bc(n){return(await this.request("/deployments",{method:"POST",data:n})).json()}async function yc(n,r,o){return(await this.request(`/deployments/${n}/${r}`,{method:"PATCH",data:o})).json()}async function gc(n,r){return(await this.request(`/deployments/${n}/${r}`,{method:"DELETE"})).status===204}async function _c(){return(await this.request("/deployments",{method:"GET"})).json()}ws.exports={predictions:{create:pc},get:mc,create:bc,update:yc,list:_c,delete:gc}});var Ts=x((ed,Rs)=>{"use strict";async function wc(){return(await this.request("/hardware",{method:"GET"})).json()}Rs.exports={list:wc}});var Cs=x((td,Es)=>{"use strict";async function Sc(n,r){return(await this.request(`/models/${n}/${r}`,{method:"GET"})).json()}async function Rc(n,r){return(await this.request(`/models/${n}/${r}/versions`,{method:"GET"})).json()}async function Tc(n,r,o){return(await this.request(`/models/${n}/${r}/versions/${o}`,{method:"GET"})).json()}async function Ec(){return(await this.request("/models",{method:"GET"})).json()}async function Cc(n,r,o){let s={owner:n,name:r,...o};return(await this.request("/models",{method:"POST",data:s})).json()}async function Pc(n){return(await this.request("/models",{method:"QUERY",headers:{"Content-Type":"text/plain"},data:n})).json()}Es.exports={get:Sc,list:Ec,create:Cc,versions:{list:Rc,get:Tc},search:Pc}});var vs=x((rd,As)=>{"use strict";var{transformFileInputs:Ps}=xt();async function Ac(n){let{model:r,version:o,stream:s,input:a,...u}=n;if(u.webhook)try{new URL(u.webhook)}catch{throw new Error("Invalid webhook URL")}let f;if(o)f=await this.request("/predictions",{method:"POST",data:{...u,input:await Ps(this,a,this.fileEncodingStrategy),version:o,stream:s}});else if(r)f=await this.request(`/models/${r}/predictions`,{method:"POST",data:{...u,input:await Ps(this,a,this.fileEncodingStrategy),stream:s}});else throw new Error("Either model or version must be specified");return f.json()}async function vc(n){return(await this.request(`/predictions/${n}`,{method:"GET"})).json()}async function Oc(n){return(await this.request(`/predictions/${n}/cancel`,{method:"POST"})).json()}async function kc(){return(await this.request("/predictions",{method:"GET"})).json()}As.exports={create:Ac,get:vc,cancel:Oc,list:kc}});var ks=x((nd,Os)=>{"use strict";async function Bc(n,r,o,s){let{...a}=s;if(a.webhook)try{new URL(a.webhook)}catch{throw new Error("Invalid webhook URL")}return(await this.request(`/models/${n}/${r}/versions/${o}/trainings`,{method:"POST",data:a})).json()}async function Ic(n){return(await this.request(`/trainings/${n}`,{method:"GET"})).json()}async function Dc(n){return(await this.request(`/trainings/${n}/cancel`,{method:"POST"})).json()}async function qc(){return(await this.request("/trainings",{method:"GET"})).json()}Os.exports={create:Bc,get:Ic,cancel:Dc,list:qc}});var Is=x((od,Bs)=>{"use strict";async function Fc(){return(await this.request("/webhooks/default/secret",{method:"GET"})).json()}Bs.exports={default:{secret:{get:Fc}}}});var Ds=x((id,Wc)=>{Wc.exports={name:"replicate",version:"0.32.0",description:"JavaScript client for Replicate",repository:"github:replicate/replicate-javascript",homepage:"https://github.com/replicate/replicate-javascript#readme",bugs:"https://github.com/replicate/replicate-javascript/issues",license:"Apache-2.0",main:"index.js",type:"commonjs",types:"index.d.ts",files:["CONTRIBUTING.md","LICENSE","README.md","index.d.ts","index.js","lib/**/*.js","vendor/**/*","package.json"],engines:{node:">=18.0.0",npm:">=7.19.0",git:">=2.11.0",yarn:">=1.7.0"},scripts:{check:"tsc",format:"biome format . --write","lint-biome":"biome lint .","lint-publint":"publint",lint:"npm run lint-biome && npm run lint-publint",test:"jest"},optionalDependencies:{"readable-stream":">=4.0.0"},devDependencies:{"@biomejs/biome":"^1.4.1","@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^5.56.0","cross-fetch":"^3.1.5",jest:"^29.7.0",nock:"^14.0.0-beta.6",publint:"^0.2.7","ts-jest":"^29.1.0",typescript:"^5.0.2"}}});var Ws=x((sd,jr)=>{"use strict";var Mc=Fr(),qs=Xi(),{createReadableStream:Lc}=ms(),{withAutomaticRetries:zc,validateWebhook:xc,parseProgressFromLogs:$c,streamAsyncIterator:jc}=xt(),Nc=ys(),Fs=_s(),gt=Ss(),zr=ro(),Uc=Ts(),_t=Cs(),xr=vs(),$r=ks(),Hc=Is(),Gc=Ds(),so=class{constructor(r={}){this.auth=r.auth||(typeof process<"u"?process.env.REPLICATE_API_TOKEN:null),this.userAgent=r.userAgent||`replicate-javascript/${Gc.version}`,this.baseUrl=r.baseUrl||"https://api.replicate.com/v1",this.fetch=r.fetch||globalThis.fetch,this.fileEncodingStrategy=r.fileEncodingStrategy??"default",this.accounts={current:Nc.current.bind(this)},this.collections={list:Fs.list.bind(this),get:Fs.get.bind(this)},this.deployments={get:gt.get.bind(this),create:gt.create.bind(this),update:gt.update.bind(this),delete:gt.delete.bind(this),list:gt.list.bind(this),predictions:{create:gt.predictions.create.bind(this)}},this.files={create:zr.create.bind(this),get:zr.get.bind(this),list:zr.list.bind(this),delete:zr.delete.bind(this)},this.hardware={list:Uc.list.bind(this)},this.models={get:_t.get.bind(this),list:_t.list.bind(this),create:_t.create.bind(this),versions:{list:_t.versions.list.bind(this),get:_t.versions.get.bind(this)},search:_t.search.bind(this)},this.predictions={create:xr.create.bind(this),get:xr.get.bind(this),cancel:xr.cancel.bind(this),list:xr.list.bind(this)},this.trainings={create:$r.create.bind(this),get:$r.get.bind(this),cancel:$r.cancel.bind(this),list:$r.list.bind(this)},this.webhooks={default:{secret:{get:Hc.default.secret.get.bind(this)}}}}async run(r,o,s){let{wait:a,signal:u,...f}=o,y=qs.parse(r),m;if(y.version)m=await this.predictions.create({...f,version:y.version});else if(y.owner&&y.name)m=await this.predictions.create({...f,model:`${y.owner}/${y.name}`});else throw new Error("Invalid model version identifier");if(s&&s(m),m=await this.wait(m,a||{},async h=>(s&&s(h),!!(u&&u.aborted))),u&&u.aborted&&(m=await this.predictions.cancel(m.id)),s&&s(m),m.status==="failed")throw new Error(`Prediction failed: ${m.error}`);return m.output}async request(r,o){let{auth:s,baseUrl:a,userAgent:u}=this,f;r instanceof URL?f=r:f=new URL(r.startsWith("/")?r.slice(1):r,a.endsWith("/")?a:`${a}/`);let{method:y="GET",params:m={},data:h}=o;for(let[w,R]of Object.entries(m))f.searchParams.append(w,R);let b={"Content-Type":"application/json","User-Agent":u};if(s&&(b.Authorization=`Bearer ${s}`),o.headers)for(let[w,R]of Object.entries(o.headers))b[w]=R;let O;h instanceof FormData?(O=h,delete b["Content-Type"]):h&&(O=JSON.stringify(h));let E={method:y,headers:b,body:O},P=y==="GET"?w=>w.status===429||w.status>=500:w=>w.status===429,g=this.fetch,v=await zc(async()=>g(f,E),{shouldRetry:P});if(!v.ok){let w=new Request(f,E),R=await v.text();throw new Mc(`Request to ${f} failed with status ${v.status} ${v.statusText}: ${R}.`,w,v)}return v}async*stream(r,o){let{wait:s,signal:a,...u}=o,f=qs.parse(r),y;if(f.version)y=await this.predictions.create({...u,version:f.version,stream:!0});else if(f.owner&&f.name)y=await this.predictions.create({...u,model:`${f.owner}/${f.name}`,stream:!0});else throw new Error("Invalid model version identifier");if(y.urls&&y.urls.stream){let m=Lc({url:y.urls.stream,fetch:this.fetch,...a?{options:{signal:a}}:{}});yield*jc(m)}else throw new Error("Prediction does not support streaming")}async*paginate(r){let o=await r();if(yield o.results,o.next){let s=()=>this.request(o.next,{method:"GET"}).then(a=>a.json());yield*this.paginate(s)}}async wait(r,o,s){let{id:a}=r;if(!a)throw new Error("Invalid prediction");if(r.status==="succeeded"||r.status==="failed"||r.status==="canceled")return r;let u=m=>new Promise(h=>setTimeout(h,m)),f=o&&o.interval||500,y=await this.predictions.get(a);for(;y.status!=="succeeded"&&y.status!=="failed"&&y.status!=="canceled"&&!(s&&await s(y)===!0);)await u(f),y=await this.predictions.get(r.id);if(y.status==="failed")throw new Error(`Prediction failed: ${y.error}`);return y}};jr.exports=so;jr.exports.validateWebhook=xc;jr.exports.parseProgressFromLogs=$c});var $s=x((Hr,xs)=>{"use strict";/**
 * @license
 * web-streams-polyfill v3.3.3
 * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
 * This code is released under the MIT license.
 * SPDX-License-Identifier: MIT
 */(function(n,r){typeof Hr=="object"&&typeof xs<"u"?r(Hr):typeof define=="function"&&define.amd?define(["exports"],r):(n=typeof globalThis<"u"?globalThis:n||self,r(n.WebStreamsPolyfill={}))})(Hr,function(n){"use strict";function r(){}function o(e){return typeof e=="object"&&e!==null||typeof e=="function"}let s=r;function a(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch{}}let u=Promise,f=Promise.prototype.then,y=Promise.reject.bind(u);function m(e){return new u(e)}function h(e){return m(t=>t(e))}function b(e){return y(e)}function O(e,t,i){return f.call(e,t,i)}function E(e,t,i){O(O(e,t,i),void 0,s)}function P(e,t){E(e,t)}function g(e,t){E(e,void 0,t)}function v(e,t,i){return O(e,t,i)}function w(e){O(e,void 0,s)}let R=e=>{if(typeof queueMicrotask=="function")R=queueMicrotask;else{let t=h(void 0);R=i=>O(t,i)}return R(e)};function D(e,t,i){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,i)}function $(e,t,i){try{return h(D(e,t,i))}catch(l){return b(l)}}let B=16384;class F{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(t){let i=this._back,l=i;i._elements.length===B-1&&(l={_elements:[],_next:void 0}),i._elements.push(t),l!==i&&(this._back=l,i._next=l),++this._size}shift(){let t=this._front,i=t,l=this._cursor,c=l+1,d=t._elements,p=d[l];return c===B&&(i=t._next,c=0),--this._size,this._cursor=c,t!==i&&(this._front=i),d[l]=void 0,p}forEach(t){let i=this._cursor,l=this._front,c=l._elements;for(;(i!==c.length||l._next!==void 0)&&!(i===c.length&&(l=l._next,c=l._elements,i=0,c.length===0));)t(c[i]),++i}peek(){let t=this._front,i=this._cursor;return t._elements[i]}}let z=Symbol("[[AbortSteps]]"),ke=Symbol("[[ErrorSteps]]"),Tt=Symbol("[[CancelSteps]]"),rn=Symbol("[[PullSteps]]"),nn=Symbol("[[ReleaseSteps]]");function _o(e,t){e._ownerReadableStream=t,t._reader=e,t._state==="readable"?sn(e):t._state==="closed"?ga(e):wo(e,t._storedError)}function on(e,t){let i=e._ownerReadableStream;return le(i,t)}function ye(e){let t=e._ownerReadableStream;t._state==="readable"?an(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):_a(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),t._readableStreamController[nn](),t._reader=void 0,e._ownerReadableStream=void 0}function Kt(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function sn(e){e._closedPromise=m((t,i)=>{e._closedPromise_resolve=t,e._closedPromise_reject=i})}function wo(e,t){sn(e),an(e,t)}function ga(e){sn(e),So(e)}function an(e,t){e._closedPromise_reject!==void 0&&(w(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function _a(e,t){wo(e,t)}function So(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let Ro=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},wa=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function Sa(e){return typeof e=="object"||typeof e=="function"}function de(e,t){if(e!==void 0&&!Sa(e))throw new TypeError(`${t} is not an object.`)}function ne(e,t){if(typeof e!="function")throw new TypeError(`${t} is not a function.`)}function Ra(e){return typeof e=="object"&&e!==null||typeof e=="function"}function To(e,t){if(!Ra(e))throw new TypeError(`${t} is not an object.`)}function ge(e,t,i){if(e===void 0)throw new TypeError(`Parameter ${t} is required in '${i}'.`)}function ln(e,t,i){if(e===void 0)throw new TypeError(`${t} is required in '${i}'.`)}function un(e){return Number(e)}function Eo(e){return e===0?0:e}function Ta(e){return Eo(wa(e))}function cn(e,t){let l=Number.MAX_SAFE_INTEGER,c=Number(e);if(c=Eo(c),!Ro(c))throw new TypeError(`${t} is not a finite number`);if(c=Ta(c),c<0||c>l)throw new TypeError(`${t} is outside the accepted range of 0 to ${l}, inclusive`);return!Ro(c)||c===0?0:c}function fn(e,t){if(!Me(e))throw new TypeError(`${t} is not a ReadableStream.`)}function ot(e){return new Be(e)}function Co(e,t){e._reader._readRequests.push(t)}function dn(e,t,i){let c=e._reader._readRequests.shift();i?c._closeSteps():c._chunkSteps(t)}function Jt(e){return e._reader._readRequests.length}function Po(e){let t=e._reader;return!(t===void 0||!Ie(t))}class Be{constructor(t){if(ge(t,1,"ReadableStreamDefaultReader"),fn(t,"First parameter"),Le(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");_o(this,t),this._readRequests=new F}get closed(){return Ie(this)?this._closedPromise:b(Zt("closed"))}cancel(t=void 0){return Ie(this)?this._ownerReadableStream===void 0?b(Kt("cancel")):on(this,t):b(Zt("cancel"))}read(){if(!Ie(this))return b(Zt("read"));if(this._ownerReadableStream===void 0)return b(Kt("read from"));let t,i,l=m((d,p)=>{t=d,i=p});return Et(this,{_chunkSteps:d=>t({value:d,done:!1}),_closeSteps:()=>t({value:void 0,done:!0}),_errorSteps:d=>i(d)}),l}releaseLock(){if(!Ie(this))throw Zt("releaseLock");this._ownerReadableStream!==void 0&&Ea(this)}}Object.defineProperties(Be.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),a(Be.prototype.cancel,"cancel"),a(Be.prototype.read,"read"),a(Be.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Be.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Ie(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof Be}function Et(e,t){let i=e._ownerReadableStream;i._disturbed=!0,i._state==="closed"?t._closeSteps():i._state==="errored"?t._errorSteps(i._storedError):i._readableStreamController[rn](t)}function Ea(e){ye(e);let t=new TypeError("Reader was released");Ao(e,t)}function Ao(e,t){let i=e._readRequests;e._readRequests=new F,i.forEach(l=>{l._errorSteps(t)})}function Zt(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}let Ca=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class vo{constructor(t,i){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=i}next(){let t=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?v(this._ongoingPromise,t,t):t(),this._ongoingPromise}return(t){let i=()=>this._returnSteps(t);return this._ongoingPromise?v(this._ongoingPromise,i,i):i()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let t=this._reader,i,l,c=m((p,_)=>{i=p,l=_});return Et(t,{_chunkSteps:p=>{this._ongoingPromise=void 0,R(()=>i({value:p,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,ye(t),i({value:void 0,done:!0})},_errorSteps:p=>{this._ongoingPromise=void 0,this._isFinished=!0,ye(t),l(p)}}),c}_returnSteps(t){if(this._isFinished)return Promise.resolve({value:t,done:!0});this._isFinished=!0;let i=this._reader;if(!this._preventCancel){let l=on(i,t);return ye(i),v(l,()=>({value:t,done:!0}))}return ye(i),h({value:t,done:!0})}}let Oo={next(){return ko(this)?this._asyncIteratorImpl.next():b(Bo("next"))},return(e){return ko(this)?this._asyncIteratorImpl.return(e):b(Bo("return"))}};Object.setPrototypeOf(Oo,Ca);function Pa(e,t){let i=ot(e),l=new vo(i,t),c=Object.create(Oo);return c._asyncIteratorImpl=l,c}function ko(e){if(!o(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof vo}catch{return!1}}function Bo(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}let Io=Number.isNaN||function(e){return e!==e};var hn,pn,mn;function Ct(e){return e.slice()}function Do(e,t,i,l,c){new Uint8Array(e).set(new Uint8Array(i,l,c),t)}let _e=e=>(typeof e.transfer=="function"?_e=t=>t.transfer():typeof structuredClone=="function"?_e=t=>structuredClone(t,{transfer:[t]}):_e=t=>t,_e(e)),De=e=>(typeof e.detached=="boolean"?De=t=>t.detached:De=t=>t.byteLength===0,De(e));function qo(e,t,i){if(e.slice)return e.slice(t,i);let l=i-t,c=new ArrayBuffer(l);return Do(c,0,e,t,l),c}function Xt(e,t){let i=e[t];if(i!=null){if(typeof i!="function")throw new TypeError(`${String(t)} is not a function`);return i}}function Aa(e){let t={[Symbol.iterator]:()=>e.iterator},i=async function*(){return yield*t}(),l=i.next;return{iterator:i,nextMethod:l,done:!1}}let bn=(mn=(hn=Symbol.asyncIterator)!==null&&hn!==void 0?hn:(pn=Symbol.for)===null||pn===void 0?void 0:pn.call(Symbol,"Symbol.asyncIterator"))!==null&&mn!==void 0?mn:"@@asyncIterator";function Fo(e,t="sync",i){if(i===void 0)if(t==="async"){if(i=Xt(e,bn),i===void 0){let d=Xt(e,Symbol.iterator),p=Fo(e,"sync",d);return Aa(p)}}else i=Xt(e,Symbol.iterator);if(i===void 0)throw new TypeError("The object is not iterable");let l=D(i,e,[]);if(!o(l))throw new TypeError("The iterator method must return an object");let c=l.next;return{iterator:l,nextMethod:c,done:!1}}function va(e){let t=D(e.nextMethod,e.iterator,[]);if(!o(t))throw new TypeError("The iterator.next() method must return an object");return t}function Oa(e){return!!e.done}function ka(e){return e.value}function Ba(e){return!(typeof e!="number"||Io(e)||e<0)}function Wo(e){let t=qo(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function yn(e){let t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function gn(e,t,i){if(!Ba(i)||i===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:i}),e._queueTotalSize+=i}function Ia(e){return e._queue.peek().value}function qe(e){e._queue=new F,e._queueTotalSize=0}function Mo(e){return e===DataView}function Da(e){return Mo(e.constructor)}function qa(e){return Mo(e)?1:e.BYTES_PER_ELEMENT}class je{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!_n(this))throw En("view");return this._view}respond(t){if(!_n(this))throw En("respond");if(ge(t,1,"respond"),t=cn(t,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(De(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");nr(this._associatedReadableByteStreamController,t)}respondWithNewView(t){if(!_n(this))throw En("respondWithNewView");if(ge(t,1,"respondWithNewView"),!ArrayBuffer.isView(t))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(De(t.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");or(this._associatedReadableByteStreamController,t)}}Object.defineProperties(je.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),a(je.prototype.respond,"respond"),a(je.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(je.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class we{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Ne(this))throw At("byobRequest");return Tn(this)}get desiredSize(){if(!Ne(this))throw At("desiredSize");return Vo(this)}close(){if(!Ne(this))throw At("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let t=this._controlledReadableByteStream._state;if(t!=="readable")throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be closed`);Pt(this)}enqueue(t){if(!Ne(this))throw At("enqueue");if(ge(t,1,"enqueue"),!ArrayBuffer.isView(t))throw new TypeError("chunk must be an array buffer view");if(t.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(t.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be enqueued to`);rr(this,t)}error(t=void 0){if(!Ne(this))throw At("error");oe(this,t)}[Tt](t){Lo(this),qe(this);let i=this._cancelAlgorithm(t);return tr(this),i}[rn](t){let i=this._controlledReadableByteStream;if(this._queueTotalSize>0){Go(this,t);return}let l=this._autoAllocateChunkSize;if(l!==void 0){let c;try{c=new ArrayBuffer(l)}catch(p){t._errorSteps(p);return}let d={buffer:c,bufferByteLength:l,byteOffset:0,byteLength:l,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(d)}Co(i,t),Ue(this)}[nn](){if(this._pendingPullIntos.length>0){let t=this._pendingPullIntos.peek();t.readerType="none",this._pendingPullIntos=new F,this._pendingPullIntos.push(t)}}}Object.defineProperties(we.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),a(we.prototype.close,"close"),a(we.prototype.enqueue,"enqueue"),a(we.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(we.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Ne(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof we}function _n(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof je}function Ue(e){if(!za(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let i=e._pullAlgorithm();E(i,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Ue(e)),null),l=>(oe(e,l),null))}function Lo(e){Sn(e),e._pendingPullIntos=new F}function wn(e,t){let i=!1;e._state==="closed"&&(i=!0);let l=zo(t);t.readerType==="default"?dn(e,l,i):Ha(e,l,i)}function zo(e){let t=e.bytesFilled,i=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/i)}function er(e,t,i,l){e._queue.push({buffer:t,byteOffset:i,byteLength:l}),e._queueTotalSize+=l}function xo(e,t,i,l){let c;try{c=qo(t,i,i+l)}catch(d){throw oe(e,d),d}er(e,c,0,l)}function $o(e,t){t.bytesFilled>0&&xo(e,t.buffer,t.byteOffset,t.bytesFilled),it(e)}function jo(e,t){let i=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),l=t.bytesFilled+i,c=i,d=!1,p=l%t.elementSize,_=l-p;_>=t.minimumFill&&(c=_-t.bytesFilled,d=!0);let C=e._queue;for(;c>0;){let S=C.peek(),A=Math.min(c,S.byteLength),k=t.byteOffset+t.bytesFilled;Do(t.buffer,k,S.buffer,S.byteOffset,A),S.byteLength===A?C.shift():(S.byteOffset+=A,S.byteLength-=A),e._queueTotalSize-=A,No(e,A,t),c-=A}return d}function No(e,t,i){i.bytesFilled+=t}function Uo(e){e._queueTotalSize===0&&e._closeRequested?(tr(e),Dt(e._controlledReadableByteStream)):Ue(e)}function Sn(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Rn(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;let t=e._pendingPullIntos.peek();jo(e,t)&&(it(e),wn(e._controlledReadableByteStream,t))}}function Fa(e){let t=e._controlledReadableByteStream._reader;for(;t._readRequests.length>0;){if(e._queueTotalSize===0)return;let i=t._readRequests.shift();Go(e,i)}}function Wa(e,t,i,l){let c=e._controlledReadableByteStream,d=t.constructor,p=qa(d),{byteOffset:_,byteLength:C}=t,S=i*p,A;try{A=_e(t.buffer)}catch(W){l._errorSteps(W);return}let k={buffer:A,bufferByteLength:A.byteLength,byteOffset:_,byteLength:C,bytesFilled:0,minimumFill:S,elementSize:p,viewConstructor:d,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(k),Ko(c,l);return}if(c._state==="closed"){let W=new d(k.buffer,k.byteOffset,0);l._closeSteps(W);return}if(e._queueTotalSize>0){if(jo(e,k)){let W=zo(k);Uo(e),l._chunkSteps(W);return}if(e._closeRequested){let W=new TypeError("Insufficient bytes to fill elements in the given buffer");oe(e,W),l._errorSteps(W);return}}e._pendingPullIntos.push(k),Ko(c,l),Ue(e)}function Ma(e,t){t.readerType==="none"&&it(e);let i=e._controlledReadableByteStream;if(Cn(i))for(;Jo(i)>0;){let l=it(e);wn(i,l)}}function La(e,t,i){if(No(e,t,i),i.readerType==="none"){$o(e,i),Rn(e);return}if(i.bytesFilled<i.minimumFill)return;it(e);let l=i.bytesFilled%i.elementSize;if(l>0){let c=i.byteOffset+i.bytesFilled;xo(e,i.buffer,c-l,l)}i.bytesFilled-=l,wn(e._controlledReadableByteStream,i),Rn(e)}function Ho(e,t){let i=e._pendingPullIntos.peek();Sn(e),e._controlledReadableByteStream._state==="closed"?Ma(e,i):La(e,t,i),Ue(e)}function it(e){return e._pendingPullIntos.shift()}function za(e){let t=e._controlledReadableByteStream;return t._state!=="readable"||e._closeRequested||!e._started?!1:!!(Po(t)&&Jt(t)>0||Cn(t)&&Jo(t)>0||Vo(e)>0)}function tr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function Pt(e){let t=e._controlledReadableByteStream;if(!(e._closeRequested||t._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0){let i=e._pendingPullIntos.peek();if(i.bytesFilled%i.elementSize!==0){let l=new TypeError("Insufficient bytes to fill elements in the given buffer");throw oe(e,l),l}}tr(e),Dt(t)}}function rr(e,t){let i=e._controlledReadableByteStream;if(e._closeRequested||i._state!=="readable")return;let{buffer:l,byteOffset:c,byteLength:d}=t;if(De(l))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let p=_e(l);if(e._pendingPullIntos.length>0){let _=e._pendingPullIntos.peek();if(De(_.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Sn(e),_.buffer=_e(_.buffer),_.readerType==="none"&&$o(e,_)}if(Po(i))if(Fa(e),Jt(i)===0)er(e,p,c,d);else{e._pendingPullIntos.length>0&&it(e);let _=new Uint8Array(p,c,d);dn(i,_,!1)}else Cn(i)?(er(e,p,c,d),Rn(e)):er(e,p,c,d);Ue(e)}function oe(e,t){let i=e._controlledReadableByteStream;i._state==="readable"&&(Lo(e),qe(e),tr(e),Si(i,t))}function Go(e,t){let i=e._queue.shift();e._queueTotalSize-=i.byteLength,Uo(e);let l=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);t._chunkSteps(l)}function Tn(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek(),i=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),l=Object.create(je.prototype);$a(l,e,i),e._byobRequest=l}return e._byobRequest}function Vo(e){let t=e._controlledReadableByteStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function nr(e,t){let i=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(t===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(i.bytesFilled+t>i.byteLength)throw new RangeError("bytesWritten out of range")}i.buffer=_e(i.buffer),Ho(e,t)}function or(e,t){let i=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(t.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(i.byteOffset+i.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(i.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(i.bytesFilled+t.byteLength>i.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let c=t.byteLength;i.buffer=_e(t.buffer),Ho(e,c)}function Yo(e,t,i,l,c,d,p){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,qe(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=d,t._pullAlgorithm=l,t._cancelAlgorithm=c,t._autoAllocateChunkSize=p,t._pendingPullIntos=new F,e._readableStreamController=t;let _=i();E(h(_),()=>(t._started=!0,Ue(t),null),C=>(oe(t,C),null))}function xa(e,t,i){let l=Object.create(we.prototype),c,d,p;t.start!==void 0?c=()=>t.start(l):c=()=>{},t.pull!==void 0?d=()=>t.pull(l):d=()=>h(void 0),t.cancel!==void 0?p=C=>t.cancel(C):p=()=>h(void 0);let _=t.autoAllocateChunkSize;if(_===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Yo(e,l,c,d,p,i,_)}function $a(e,t,i){e._associatedReadableByteStreamController=t,e._view=i}function En(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function At(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function ja(e,t){de(e,t);let i=e?.mode;return{mode:i===void 0?void 0:Na(i,`${t} has member 'mode' that`)}}function Na(e,t){if(e=`${e}`,e!=="byob")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function Ua(e,t){var i;de(e,t);let l=(i=e?.min)!==null&&i!==void 0?i:1;return{min:cn(l,`${t} has member 'min' that`)}}function Qo(e){return new Fe(e)}function Ko(e,t){e._reader._readIntoRequests.push(t)}function Ha(e,t,i){let c=e._reader._readIntoRequests.shift();i?c._closeSteps(t):c._chunkSteps(t)}function Jo(e){return e._reader._readIntoRequests.length}function Cn(e){let t=e._reader;return!(t===void 0||!He(t))}class Fe{constructor(t){if(ge(t,1,"ReadableStreamBYOBReader"),fn(t,"First parameter"),Le(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Ne(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");_o(this,t),this._readIntoRequests=new F}get closed(){return He(this)?this._closedPromise:b(ir("closed"))}cancel(t=void 0){return He(this)?this._ownerReadableStream===void 0?b(Kt("cancel")):on(this,t):b(ir("cancel"))}read(t,i={}){if(!He(this))return b(ir("read"));if(!ArrayBuffer.isView(t))return b(new TypeError("view must be an array buffer view"));if(t.byteLength===0)return b(new TypeError("view must have non-zero byteLength"));if(t.buffer.byteLength===0)return b(new TypeError("view's buffer must have non-zero byteLength"));if(De(t.buffer))return b(new TypeError("view's buffer has been detached"));let l;try{l=Ua(i,"options")}catch(S){return b(S)}let c=l.min;if(c===0)return b(new TypeError("options.min must be greater than 0"));if(Da(t)){if(c>t.byteLength)return b(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(c>t.length)return b(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return b(Kt("read from"));let d,p,_=m((S,A)=>{d=S,p=A});return Zo(this,t,c,{_chunkSteps:S=>d({value:S,done:!1}),_closeSteps:S=>d({value:S,done:!0}),_errorSteps:S=>p(S)}),_}releaseLock(){if(!He(this))throw ir("releaseLock");this._ownerReadableStream!==void 0&&Ga(this)}}Object.defineProperties(Fe.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),a(Fe.prototype.cancel,"cancel"),a(Fe.prototype.read,"read"),a(Fe.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Fe.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function He(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof Fe}function Zo(e,t,i,l){let c=e._ownerReadableStream;c._disturbed=!0,c._state==="errored"?l._errorSteps(c._storedError):Wa(c._readableStreamController,t,i,l)}function Ga(e){ye(e);let t=new TypeError("Reader was released");Xo(e,t)}function Xo(e,t){let i=e._readIntoRequests;e._readIntoRequests=new F,i.forEach(l=>{l._errorSteps(t)})}function ir(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function vt(e,t){let{highWaterMark:i}=e;if(i===void 0)return t;if(Io(i)||i<0)throw new RangeError("Invalid highWaterMark");return i}function sr(e){let{size:t}=e;return t||(()=>1)}function ar(e,t){de(e,t);let i=e?.highWaterMark,l=e?.size;return{highWaterMark:i===void 0?void 0:un(i),size:l===void 0?void 0:Va(l,`${t} has member 'size' that`)}}function Va(e,t){return ne(e,t),i=>un(e(i))}function Ya(e,t){de(e,t);let i=e?.abort,l=e?.close,c=e?.start,d=e?.type,p=e?.write;return{abort:i===void 0?void 0:Qa(i,e,`${t} has member 'abort' that`),close:l===void 0?void 0:Ka(l,e,`${t} has member 'close' that`),start:c===void 0?void 0:Ja(c,e,`${t} has member 'start' that`),write:p===void 0?void 0:Za(p,e,`${t} has member 'write' that`),type:d}}function Qa(e,t,i){return ne(e,i),l=>$(e,t,[l])}function Ka(e,t,i){return ne(e,i),()=>$(e,t,[])}function Ja(e,t,i){return ne(e,i),l=>D(e,t,[l])}function Za(e,t,i){return ne(e,i),(l,c)=>$(e,t,[l,c])}function ei(e,t){if(!st(e))throw new TypeError(`${t} is not a WritableStream.`)}function Xa(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}let el=typeof AbortController=="function";function tl(){if(el)return new AbortController}class We{constructor(t={},i={}){t===void 0?t=null:To(t,"First parameter");let l=ar(i,"Second parameter"),c=Ya(t,"First parameter");if(ri(this),c.type!==void 0)throw new RangeError("Invalid type is specified");let p=sr(l),_=vt(l,1);ml(this,c,_,p)}get locked(){if(!st(this))throw dr("locked");return at(this)}abort(t=void 0){return st(this)?at(this)?b(new TypeError("Cannot abort a stream that already has a writer")):lr(this,t):b(dr("abort"))}close(){return st(this)?at(this)?b(new TypeError("Cannot close a stream that already has a writer")):he(this)?b(new TypeError("Cannot close an already-closing stream")):ni(this):b(dr("close"))}getWriter(){if(!st(this))throw dr("getWriter");return ti(this)}}Object.defineProperties(We.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),a(We.prototype.abort,"abort"),a(We.prototype.close,"close"),a(We.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(We.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function ti(e){return new Se(e)}function rl(e,t,i,l,c=1,d=()=>1){let p=Object.create(We.prototype);ri(p);let _=Object.create(lt.prototype);return ui(p,_,e,t,i,l,c,d),p}function ri(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new F,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function st(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof We}function at(e){return e._writer!==void 0}function lr(e,t){var i;if(e._state==="closed"||e._state==="errored")return h(void 0);e._writableStreamController._abortReason=t,(i=e._writableStreamController._abortController)===null||i===void 0||i.abort(t);let l=e._state;if(l==="closed"||l==="errored")return h(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let c=!1;l==="erroring"&&(c=!0,t=void 0);let d=m((p,_)=>{e._pendingAbortRequest={_promise:void 0,_resolve:p,_reject:_,_reason:t,_wasAlreadyErroring:c}});return e._pendingAbortRequest._promise=d,c||An(e,t),d}function ni(e){let t=e._state;if(t==="closed"||t==="errored")return b(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));let i=m((c,d)=>{let p={_resolve:c,_reject:d};e._closeRequest=p}),l=e._writer;return l!==void 0&&e._backpressure&&t==="writable"&&Fn(l),bl(e._writableStreamController),i}function nl(e){return m((i,l)=>{let c={_resolve:i,_reject:l};e._writeRequests.push(c)})}function Pn(e,t){if(e._state==="writable"){An(e,t);return}vn(e)}function An(e,t){let i=e._writableStreamController;e._state="erroring",e._storedError=t;let l=e._writer;l!==void 0&&ii(l,t),!ll(e)&&i._started&&vn(e)}function vn(e){e._state="errored",e._writableStreamController[ke]();let t=e._storedError;if(e._writeRequests.forEach(c=>{c._reject(t)}),e._writeRequests=new F,e._pendingAbortRequest===void 0){ur(e);return}let i=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,i._wasAlreadyErroring){i._reject(t),ur(e);return}let l=e._writableStreamController[z](i._reason);E(l,()=>(i._resolve(),ur(e),null),c=>(i._reject(c),ur(e),null))}function ol(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function il(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Pn(e,t)}function sl(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let i=e._writer;i!==void 0&&hi(i)}function al(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Pn(e,t)}function he(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function ll(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function ul(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function cl(e){e._inFlightWriteRequest=e._writeRequests.shift()}function ur(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let t=e._writer;t!==void 0&&Dn(t,e._storedError)}function On(e,t){let i=e._writer;i!==void 0&&t!==e._backpressure&&(t?Tl(i):Fn(i)),e._backpressure=t}class Se{constructor(t){if(ge(t,1,"WritableStreamDefaultWriter"),ei(t,"First parameter"),at(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;let i=t._state;if(i==="writable")!he(t)&&t._backpressure?pr(this):pi(this),hr(this);else if(i==="erroring")qn(this,t._storedError),hr(this);else if(i==="closed")pi(this),Sl(this);else{let l=t._storedError;qn(this,l),di(this,l)}}get closed(){return Ge(this)?this._closedPromise:b(Ve("closed"))}get desiredSize(){if(!Ge(this))throw Ve("desiredSize");if(this._ownerWritableStream===void 0)throw kt("desiredSize");return pl(this)}get ready(){return Ge(this)?this._readyPromise:b(Ve("ready"))}abort(t=void 0){return Ge(this)?this._ownerWritableStream===void 0?b(kt("abort")):fl(this,t):b(Ve("abort"))}close(){if(!Ge(this))return b(Ve("close"));let t=this._ownerWritableStream;return t===void 0?b(kt("close")):he(t)?b(new TypeError("Cannot close an already-closing stream")):oi(this)}releaseLock(){if(!Ge(this))throw Ve("releaseLock");this._ownerWritableStream!==void 0&&si(this)}write(t=void 0){return Ge(this)?this._ownerWritableStream===void 0?b(kt("write to")):ai(this,t):b(Ve("write"))}}Object.defineProperties(Se.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),a(Se.prototype.abort,"abort"),a(Se.prototype.close,"close"),a(Se.prototype.releaseLock,"releaseLock"),a(Se.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Se.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Ge(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof Se}function fl(e,t){let i=e._ownerWritableStream;return lr(i,t)}function oi(e){let t=e._ownerWritableStream;return ni(t)}function dl(e){let t=e._ownerWritableStream,i=t._state;return he(t)||i==="closed"?h(void 0):i==="errored"?b(t._storedError):oi(e)}function hl(e,t){e._closedPromiseState==="pending"?Dn(e,t):Rl(e,t)}function ii(e,t){e._readyPromiseState==="pending"?mi(e,t):El(e,t)}function pl(e){let t=e._ownerWritableStream,i=t._state;return i==="errored"||i==="erroring"?null:i==="closed"?0:ci(t._writableStreamController)}function si(e){let t=e._ownerWritableStream,i=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");ii(e,i),hl(e,i),t._writer=void 0,e._ownerWritableStream=void 0}function ai(e,t){let i=e._ownerWritableStream,l=i._writableStreamController,c=yl(l,t);if(i!==e._ownerWritableStream)return b(kt("write to"));let d=i._state;if(d==="errored")return b(i._storedError);if(he(i)||d==="closed")return b(new TypeError("The stream is closing or closed and cannot be written to"));if(d==="erroring")return b(i._storedError);let p=nl(i);return gl(l,t,c),p}let li={};class lt{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!kn(this))throw In("abortReason");return this._abortReason}get signal(){if(!kn(this))throw In("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(t=void 0){if(!kn(this))throw In("error");this._controlledWritableStream._state==="writable"&&fi(this,t)}[z](t){let i=this._abortAlgorithm(t);return cr(this),i}[ke](){qe(this)}}Object.defineProperties(lt.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(lt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function kn(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof lt}function ui(e,t,i,l,c,d,p,_){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,qe(t),t._abortReason=void 0,t._abortController=tl(),t._started=!1,t._strategySizeAlgorithm=_,t._strategyHWM=p,t._writeAlgorithm=l,t._closeAlgorithm=c,t._abortAlgorithm=d;let C=Bn(t);On(e,C);let S=i(),A=h(S);E(A,()=>(t._started=!0,fr(t),null),k=>(t._started=!0,Pn(e,k),null))}function ml(e,t,i,l){let c=Object.create(lt.prototype),d,p,_,C;t.start!==void 0?d=()=>t.start(c):d=()=>{},t.write!==void 0?p=S=>t.write(S,c):p=()=>h(void 0),t.close!==void 0?_=()=>t.close():_=()=>h(void 0),t.abort!==void 0?C=S=>t.abort(S):C=()=>h(void 0),ui(e,c,d,p,_,C,i,l)}function cr(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function bl(e){gn(e,li,0),fr(e)}function yl(e,t){try{return e._strategySizeAlgorithm(t)}catch(i){return Ot(e,i),1}}function ci(e){return e._strategyHWM-e._queueTotalSize}function gl(e,t,i){try{gn(e,t,i)}catch(c){Ot(e,c);return}let l=e._controlledWritableStream;if(!he(l)&&l._state==="writable"){let c=Bn(e);On(l,c)}fr(e)}function fr(e){let t=e._controlledWritableStream;if(!e._started||t._inFlightWriteRequest!==void 0)return;if(t._state==="erroring"){vn(t);return}if(e._queue.length===0)return;let l=Ia(e);l===li?_l(e):wl(e,l)}function Ot(e,t){e._controlledWritableStream._state==="writable"&&fi(e,t)}function _l(e){let t=e._controlledWritableStream;ul(t),yn(e);let i=e._closeAlgorithm();cr(e),E(i,()=>(sl(t),null),l=>(al(t,l),null))}function wl(e,t){let i=e._controlledWritableStream;cl(i);let l=e._writeAlgorithm(t);E(l,()=>{ol(i);let c=i._state;if(yn(e),!he(i)&&c==="writable"){let d=Bn(e);On(i,d)}return fr(e),null},c=>(i._state==="writable"&&cr(e),il(i,c),null))}function Bn(e){return ci(e)<=0}function fi(e,t){let i=e._controlledWritableStream;cr(e),An(i,t)}function dr(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function In(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function Ve(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function kt(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function hr(e){e._closedPromise=m((t,i)=>{e._closedPromise_resolve=t,e._closedPromise_reject=i,e._closedPromiseState="pending"})}function di(e,t){hr(e),Dn(e,t)}function Sl(e){hr(e),hi(e)}function Dn(e,t){e._closedPromise_reject!==void 0&&(w(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function Rl(e,t){di(e,t)}function hi(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function pr(e){e._readyPromise=m((t,i)=>{e._readyPromise_resolve=t,e._readyPromise_reject=i}),e._readyPromiseState="pending"}function qn(e,t){pr(e),mi(e,t)}function pi(e){pr(e),Fn(e)}function mi(e,t){e._readyPromise_reject!==void 0&&(w(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function Tl(e){pr(e)}function El(e,t){qn(e,t)}function Fn(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}function Cl(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Wn=Cl();function Pl(e){if(!(typeof e=="function"||typeof e=="object")||e.name!=="DOMException")return!1;try{return new e,!0}catch{return!1}}function Al(){let e=Wn?.DOMException;return Pl(e)?e:void 0}function vl(){let e=function(i,l){this.message=i||"",this.name=l||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return a(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}let Ol=Al()||vl();function bi(e,t,i,l,c,d){let p=ot(e),_=ti(t);e._disturbed=!0;let C=!1,S=h(void 0);return m((A,k)=>{let W;if(d!==void 0){if(W=()=>{let T=d.reason!==void 0?d.reason:new Ol("Aborted","AbortError"),I=[];l||I.push(()=>t._state==="writable"?lr(t,T):h(void 0)),c||I.push(()=>e._state==="readable"?le(e,T):h(void 0)),V(()=>Promise.all(I.map(M=>M())),!0,T)},d.aborted){W();return}d.addEventListener("abort",W)}function ue(){return m((T,I)=>{function M(Z){Z?T():O(dt(),M,I)}M(!1)})}function dt(){return C?h(!0):O(_._readyPromise,()=>m((T,I)=>{Et(p,{_chunkSteps:M=>{S=O(ai(_,M),void 0,r),T(!1)},_closeSteps:()=>T(!0),_errorSteps:I})}))}if(Te(e,p._closedPromise,T=>(l?ie(!0,T):V(()=>lr(t,T),!0,T),null)),Te(t,_._closedPromise,T=>(c?ie(!0,T):V(()=>le(e,T),!0,T),null)),H(e,p._closedPromise,()=>(i?ie():V(()=>dl(_)),null)),he(t)||t._state==="closed"){let T=new TypeError("the destination writable stream closed before all data could be piped to it");c?ie(!0,T):V(()=>le(e,T),!0,T)}w(ue());function xe(){let T=S;return O(S,()=>T!==S?xe():void 0)}function Te(T,I,M){T._state==="errored"?M(T._storedError):g(I,M)}function H(T,I,M){T._state==="closed"?M():P(I,M)}function V(T,I,M){if(C)return;C=!0,t._state==="writable"&&!he(t)?P(xe(),Z):Z();function Z(){return E(T(),()=>Ee(I,M),ht=>Ee(!0,ht)),null}}function ie(T,I){C||(C=!0,t._state==="writable"&&!he(t)?P(xe(),()=>Ee(T,I)):Ee(T,I))}function Ee(T,I){return si(_),ye(p),d!==void 0&&d.removeEventListener("abort",W),T?k(I):A(void 0),null}})}class Re{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!mr(this))throw yr("desiredSize");return Mn(this)}close(){if(!mr(this))throw yr("close");if(!ct(this))throw new TypeError("The stream is not in a state that permits close");Ye(this)}enqueue(t=void 0){if(!mr(this))throw yr("enqueue");if(!ct(this))throw new TypeError("The stream is not in a state that permits enqueue");return ut(this,t)}error(t=void 0){if(!mr(this))throw yr("error");ae(this,t)}[Tt](t){qe(this);let i=this._cancelAlgorithm(t);return br(this),i}[rn](t){let i=this._controlledReadableStream;if(this._queue.length>0){let l=yn(this);this._closeRequested&&this._queue.length===0?(br(this),Dt(i)):Bt(this),t._chunkSteps(l)}else Co(i,t),Bt(this)}[nn](){}}Object.defineProperties(Re.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),a(Re.prototype.close,"close"),a(Re.prototype.enqueue,"enqueue"),a(Re.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Re.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function mr(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof Re}function Bt(e){if(!yi(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let i=e._pullAlgorithm();E(i,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Bt(e)),null),l=>(ae(e,l),null))}function yi(e){let t=e._controlledReadableStream;return!ct(e)||!e._started?!1:!!(Le(t)&&Jt(t)>0||Mn(e)>0)}function br(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Ye(e){if(!ct(e))return;let t=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(br(e),Dt(t))}function ut(e,t){if(!ct(e))return;let i=e._controlledReadableStream;if(Le(i)&&Jt(i)>0)dn(i,t,!1);else{let l;try{l=e._strategySizeAlgorithm(t)}catch(c){throw ae(e,c),c}try{gn(e,t,l)}catch(c){throw ae(e,c),c}}Bt(e)}function ae(e,t){let i=e._controlledReadableStream;i._state==="readable"&&(qe(e),br(e),Si(i,t))}function Mn(e){let t=e._controlledReadableStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function kl(e){return!yi(e)}function ct(e){let t=e._controlledReadableStream._state;return!e._closeRequested&&t==="readable"}function gi(e,t,i,l,c,d,p){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,qe(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=p,t._strategyHWM=d,t._pullAlgorithm=l,t._cancelAlgorithm=c,e._readableStreamController=t;let _=i();E(h(_),()=>(t._started=!0,Bt(t),null),C=>(ae(t,C),null))}function Bl(e,t,i,l){let c=Object.create(Re.prototype),d,p,_;t.start!==void 0?d=()=>t.start(c):d=()=>{},t.pull!==void 0?p=()=>t.pull(c):p=()=>h(void 0),t.cancel!==void 0?_=C=>t.cancel(C):_=()=>h(void 0),gi(e,c,d,p,_,i,l)}function yr(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function Il(e,t){return Ne(e._readableStreamController)?ql(e):Dl(e)}function Dl(e,t){let i=ot(e),l=!1,c=!1,d=!1,p=!1,_,C,S,A,k,W=m(H=>{k=H});function ue(){return l?(c=!0,h(void 0)):(l=!0,Et(i,{_chunkSteps:V=>{R(()=>{c=!1;let ie=V,Ee=V;d||ut(S._readableStreamController,ie),p||ut(A._readableStreamController,Ee),l=!1,c&&ue()})},_closeSteps:()=>{l=!1,d||Ye(S._readableStreamController),p||Ye(A._readableStreamController),(!d||!p)&&k(void 0)},_errorSteps:()=>{l=!1}}),h(void 0))}function dt(H){if(d=!0,_=H,p){let V=Ct([_,C]),ie=le(e,V);k(ie)}return W}function xe(H){if(p=!0,C=H,d){let V=Ct([_,C]),ie=le(e,V);k(ie)}return W}function Te(){}return S=It(Te,ue,dt),A=It(Te,ue,xe),g(i._closedPromise,H=>(ae(S._readableStreamController,H),ae(A._readableStreamController,H),(!d||!p)&&k(void 0),null)),[S,A]}function ql(e){let t=ot(e),i=!1,l=!1,c=!1,d=!1,p=!1,_,C,S,A,k,W=m(T=>{k=T});function ue(T){g(T._closedPromise,I=>(T!==t||(oe(S._readableStreamController,I),oe(A._readableStreamController,I),(!d||!p)&&k(void 0)),null))}function dt(){He(t)&&(ye(t),t=ot(e),ue(t)),Et(t,{_chunkSteps:I=>{R(()=>{l=!1,c=!1;let M=I,Z=I;if(!d&&!p)try{Z=Wo(I)}catch(ht){oe(S._readableStreamController,ht),oe(A._readableStreamController,ht),k(le(e,ht));return}d||rr(S._readableStreamController,M),p||rr(A._readableStreamController,Z),i=!1,l?Te():c&&H()})},_closeSteps:()=>{i=!1,d||Pt(S._readableStreamController),p||Pt(A._readableStreamController),S._readableStreamController._pendingPullIntos.length>0&&nr(S._readableStreamController,0),A._readableStreamController._pendingPullIntos.length>0&&nr(A._readableStreamController,0),(!d||!p)&&k(void 0)},_errorSteps:()=>{i=!1}})}function xe(T,I){Ie(t)&&(ye(t),t=Qo(e),ue(t));let M=I?A:S,Z=I?S:A;Zo(t,T,1,{_chunkSteps:pt=>{R(()=>{l=!1,c=!1;let mt=I?p:d;if(I?d:p)mt||or(M._readableStreamController,pt);else{let qi;try{qi=Wo(pt)}catch(jn){oe(M._readableStreamController,jn),oe(Z._readableStreamController,jn),k(le(e,jn));return}mt||or(M._readableStreamController,pt),rr(Z._readableStreamController,qi)}i=!1,l?Te():c&&H()})},_closeSteps:pt=>{i=!1;let mt=I?p:d,Cr=I?d:p;mt||Pt(M._readableStreamController),Cr||Pt(Z._readableStreamController),pt!==void 0&&(mt||or(M._readableStreamController,pt),!Cr&&Z._readableStreamController._pendingPullIntos.length>0&&nr(Z._readableStreamController,0)),(!mt||!Cr)&&k(void 0)},_errorSteps:()=>{i=!1}})}function Te(){if(i)return l=!0,h(void 0);i=!0;let T=Tn(S._readableStreamController);return T===null?dt():xe(T._view,!1),h(void 0)}function H(){if(i)return c=!0,h(void 0);i=!0;let T=Tn(A._readableStreamController);return T===null?dt():xe(T._view,!0),h(void 0)}function V(T){if(d=!0,_=T,p){let I=Ct([_,C]),M=le(e,I);k(M)}return W}function ie(T){if(p=!0,C=T,d){let I=Ct([_,C]),M=le(e,I);k(M)}return W}function Ee(){}return S=wi(Ee,Te,V),A=wi(Ee,H,ie),ue(t),[S,A]}function Fl(e){return o(e)&&typeof e.getReader<"u"}function Wl(e){return Fl(e)?Ll(e.getReader()):Ml(e)}function Ml(e){let t,i=Fo(e,"async"),l=r;function c(){let p;try{p=va(i)}catch(C){return b(C)}let _=h(p);return v(_,C=>{if(!o(C))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(Oa(C))Ye(t._readableStreamController);else{let A=ka(C);ut(t._readableStreamController,A)}})}function d(p){let _=i.iterator,C;try{C=Xt(_,"return")}catch(k){return b(k)}if(C===void 0)return h(void 0);let S;try{S=D(C,_,[p])}catch(k){return b(k)}let A=h(S);return v(A,k=>{if(!o(k))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return t=It(l,c,d,0),t}function Ll(e){let t,i=r;function l(){let d;try{d=e.read()}catch(p){return b(p)}return v(d,p=>{if(!o(p))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(p.done)Ye(t._readableStreamController);else{let _=p.value;ut(t._readableStreamController,_)}})}function c(d){try{return h(e.cancel(d))}catch(p){return b(p)}}return t=It(i,l,c,0),t}function zl(e,t){de(e,t);let i=e,l=i?.autoAllocateChunkSize,c=i?.cancel,d=i?.pull,p=i?.start,_=i?.type;return{autoAllocateChunkSize:l===void 0?void 0:cn(l,`${t} has member 'autoAllocateChunkSize' that`),cancel:c===void 0?void 0:xl(c,i,`${t} has member 'cancel' that`),pull:d===void 0?void 0:$l(d,i,`${t} has member 'pull' that`),start:p===void 0?void 0:jl(p,i,`${t} has member 'start' that`),type:_===void 0?void 0:Nl(_,`${t} has member 'type' that`)}}function xl(e,t,i){return ne(e,i),l=>$(e,t,[l])}function $l(e,t,i){return ne(e,i),l=>$(e,t,[l])}function jl(e,t,i){return ne(e,i),l=>D(e,t,[l])}function Nl(e,t){if(e=`${e}`,e!=="bytes")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function Ul(e,t){return de(e,t),{preventCancel:!!e?.preventCancel}}function _i(e,t){de(e,t);let i=e?.preventAbort,l=e?.preventCancel,c=e?.preventClose,d=e?.signal;return d!==void 0&&Hl(d,`${t} has member 'signal' that`),{preventAbort:!!i,preventCancel:!!l,preventClose:!!c,signal:d}}function Hl(e,t){if(!Xa(e))throw new TypeError(`${t} is not an AbortSignal.`)}function Gl(e,t){de(e,t);let i=e?.readable;ln(i,"readable","ReadableWritablePair"),fn(i,`${t} has member 'readable' that`);let l=e?.writable;return ln(l,"writable","ReadableWritablePair"),ei(l,`${t} has member 'writable' that`),{readable:i,writable:l}}class U{constructor(t={},i={}){t===void 0?t=null:To(t,"First parameter");let l=ar(i,"Second parameter"),c=zl(t,"First parameter");if(Ln(this),c.type==="bytes"){if(l.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let d=vt(l,0);xa(this,c,d)}else{let d=sr(l),p=vt(l,1);Bl(this,c,p,d)}}get locked(){if(!Me(this))throw Qe("locked");return Le(this)}cancel(t=void 0){return Me(this)?Le(this)?b(new TypeError("Cannot cancel a stream that already has a reader")):le(this,t):b(Qe("cancel"))}getReader(t=void 0){if(!Me(this))throw Qe("getReader");return ja(t,"First parameter").mode===void 0?ot(this):Qo(this)}pipeThrough(t,i={}){if(!Me(this))throw Qe("pipeThrough");ge(t,1,"pipeThrough");let l=Gl(t,"First parameter"),c=_i(i,"Second parameter");if(Le(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(at(l.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let d=bi(this,l.writable,c.preventClose,c.preventAbort,c.preventCancel,c.signal);return w(d),l.readable}pipeTo(t,i={}){if(!Me(this))return b(Qe("pipeTo"));if(t===void 0)return b("Parameter 1 is required in 'pipeTo'.");if(!st(t))return b(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let l;try{l=_i(i,"Second parameter")}catch(c){return b(c)}return Le(this)?b(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):at(t)?b(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):bi(this,t,l.preventClose,l.preventAbort,l.preventCancel,l.signal)}tee(){if(!Me(this))throw Qe("tee");let t=Il(this);return Ct(t)}values(t=void 0){if(!Me(this))throw Qe("values");let i=Ul(t,"First parameter");return Pa(this,i.preventCancel)}[bn](t){return this.values(t)}static from(t){return Wl(t)}}Object.defineProperties(U,{from:{enumerable:!0}}),Object.defineProperties(U.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),a(U.from,"from"),a(U.prototype.cancel,"cancel"),a(U.prototype.getReader,"getReader"),a(U.prototype.pipeThrough,"pipeThrough"),a(U.prototype.pipeTo,"pipeTo"),a(U.prototype.tee,"tee"),a(U.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(U.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(U.prototype,bn,{value:U.prototype.values,writable:!0,configurable:!0});function It(e,t,i,l=1,c=()=>1){let d=Object.create(U.prototype);Ln(d);let p=Object.create(Re.prototype);return gi(d,p,e,t,i,l,c),d}function wi(e,t,i){let l=Object.create(U.prototype);Ln(l);let c=Object.create(we.prototype);return Yo(l,c,e,t,i,0,void 0),l}function Ln(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function Me(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof U}function Le(e){return e._reader!==void 0}function le(e,t){if(e._disturbed=!0,e._state==="closed")return h(void 0);if(e._state==="errored")return b(e._storedError);Dt(e);let i=e._reader;if(i!==void 0&&He(i)){let c=i._readIntoRequests;i._readIntoRequests=new F,c.forEach(d=>{d._closeSteps(void 0)})}let l=e._readableStreamController[Tt](t);return v(l,r)}function Dt(e){e._state="closed";let t=e._reader;if(t!==void 0&&(So(t),Ie(t))){let i=t._readRequests;t._readRequests=new F,i.forEach(l=>{l._closeSteps()})}}function Si(e,t){e._state="errored",e._storedError=t;let i=e._reader;i!==void 0&&(an(i,t),Ie(i)?Ao(i,t):Xo(i,t))}function Qe(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function Ri(e,t){de(e,t);let i=e?.highWaterMark;return ln(i,"highWaterMark","QueuingStrategyInit"),{highWaterMark:un(i)}}let Ti=e=>e.byteLength;a(Ti,"size");class gr{constructor(t){ge(t,1,"ByteLengthQueuingStrategy"),t=Ri(t,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!Ci(this))throw Ei("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Ci(this))throw Ei("size");return Ti}}Object.defineProperties(gr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(gr.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Ei(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function Ci(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof gr}let Pi=()=>1;a(Pi,"size");class _r{constructor(t){ge(t,1,"CountQueuingStrategy"),t=Ri(t,"First parameter"),this._countQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!vi(this))throw Ai("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!vi(this))throw Ai("size");return Pi}}Object.defineProperties(_r.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(_r.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Ai(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function vi(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof _r}function Vl(e,t){de(e,t);let i=e?.cancel,l=e?.flush,c=e?.readableType,d=e?.start,p=e?.transform,_=e?.writableType;return{cancel:i===void 0?void 0:Jl(i,e,`${t} has member 'cancel' that`),flush:l===void 0?void 0:Yl(l,e,`${t} has member 'flush' that`),readableType:c,start:d===void 0?void 0:Ql(d,e,`${t} has member 'start' that`),transform:p===void 0?void 0:Kl(p,e,`${t} has member 'transform' that`),writableType:_}}function Yl(e,t,i){return ne(e,i),l=>$(e,t,[l])}function Ql(e,t,i){return ne(e,i),l=>D(e,t,[l])}function Kl(e,t,i){return ne(e,i),(l,c)=>$(e,t,[l,c])}function Jl(e,t,i){return ne(e,i),l=>$(e,t,[l])}class wr{constructor(t={},i={},l={}){t===void 0&&(t=null);let c=ar(i,"Second parameter"),d=ar(l,"Third parameter"),p=Vl(t,"First parameter");if(p.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(p.writableType!==void 0)throw new RangeError("Invalid writableType specified");let _=vt(d,0),C=sr(d),S=vt(c,1),A=sr(c),k,W=m(ue=>{k=ue});Zl(this,W,S,A,_,C),eu(this,p),p.start!==void 0?k(p.start(this._transformStreamController)):k(void 0)}get readable(){if(!Oi(this))throw Di("readable");return this._readable}get writable(){if(!Oi(this))throw Di("writable");return this._writable}}Object.defineProperties(wr.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(wr.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function Zl(e,t,i,l,c,d){function p(){return t}function _(W){return nu(e,W)}function C(W){return ou(e,W)}function S(){return iu(e)}e._writable=rl(p,_,S,C,i,l);function A(){return su(e)}function k(W){return au(e,W)}e._readable=It(p,A,k,c,d),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,Sr(e,!0),e._transformStreamController=void 0}function Oi(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof wr}function ki(e,t){ae(e._readable._readableStreamController,t),zn(e,t)}function zn(e,t){Tr(e._transformStreamController),Ot(e._writable._writableStreamController,t),xn(e)}function xn(e){e._backpressure&&Sr(e,!1)}function Sr(e,t){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=m(i=>{e._backpressureChangePromise_resolve=i}),e._backpressure=t}class ze{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Rr(this))throw Er("desiredSize");let t=this._controlledTransformStream._readable._readableStreamController;return Mn(t)}enqueue(t=void 0){if(!Rr(this))throw Er("enqueue");Bi(this,t)}error(t=void 0){if(!Rr(this))throw Er("error");tu(this,t)}terminate(){if(!Rr(this))throw Er("terminate");ru(this)}}Object.defineProperties(ze.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),a(ze.prototype.enqueue,"enqueue"),a(ze.prototype.error,"error"),a(ze.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ze.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Rr(e){return!o(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof ze}function Xl(e,t,i,l,c){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=i,t._flushAlgorithm=l,t._cancelAlgorithm=c,t._finishPromise=void 0,t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0}function eu(e,t){let i=Object.create(ze.prototype),l,c,d;t.transform!==void 0?l=p=>t.transform(p,i):l=p=>{try{return Bi(i,p),h(void 0)}catch(_){return b(_)}},t.flush!==void 0?c=()=>t.flush(i):c=()=>h(void 0),t.cancel!==void 0?d=p=>t.cancel(p):d=()=>h(void 0),Xl(e,i,l,c,d)}function Tr(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function Bi(e,t){let i=e._controlledTransformStream,l=i._readable._readableStreamController;if(!ct(l))throw new TypeError("Readable side is not in a state that permits enqueue");try{ut(l,t)}catch(d){throw zn(i,d),i._readable._storedError}kl(l)!==i._backpressure&&Sr(i,!0)}function tu(e,t){ki(e._controlledTransformStream,t)}function Ii(e,t){let i=e._transformAlgorithm(t);return v(i,void 0,l=>{throw ki(e._controlledTransformStream,l),l})}function ru(e){let t=e._controlledTransformStream,i=t._readable._readableStreamController;Ye(i);let l=new TypeError("TransformStream terminated");zn(t,l)}function nu(e,t){let i=e._transformStreamController;if(e._backpressure){let l=e._backpressureChangePromise;return v(l,()=>{let c=e._writable;if(c._state==="erroring")throw c._storedError;return Ii(i,t)})}return Ii(i,t)}function ou(e,t){let i=e._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let l=e._readable;i._finishPromise=m((d,p)=>{i._finishPromise_resolve=d,i._finishPromise_reject=p});let c=i._cancelAlgorithm(t);return Tr(i),E(c,()=>(l._state==="errored"?ft(i,l._storedError):(ae(l._readableStreamController,t),$n(i)),null),d=>(ae(l._readableStreamController,d),ft(i,d),null)),i._finishPromise}function iu(e){let t=e._transformStreamController;if(t._finishPromise!==void 0)return t._finishPromise;let i=e._readable;t._finishPromise=m((c,d)=>{t._finishPromise_resolve=c,t._finishPromise_reject=d});let l=t._flushAlgorithm();return Tr(t),E(l,()=>(i._state==="errored"?ft(t,i._storedError):(Ye(i._readableStreamController),$n(t)),null),c=>(ae(i._readableStreamController,c),ft(t,c),null)),t._finishPromise}function su(e){return Sr(e,!1),e._backpressureChangePromise}function au(e,t){let i=e._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let l=e._writable;i._finishPromise=m((d,p)=>{i._finishPromise_resolve=d,i._finishPromise_reject=p});let c=i._cancelAlgorithm(t);return Tr(i),E(c,()=>(l._state==="errored"?ft(i,l._storedError):(Ot(l._writableStreamController,t),xn(e),$n(i)),null),d=>(Ot(l._writableStreamController,d),xn(e),ft(i,d),null)),i._finishPromise}function Er(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function $n(e){e._finishPromise_resolve!==void 0&&(e._finishPromise_resolve(),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function ft(e,t){e._finishPromise_reject!==void 0&&(w(e._finishPromise),e._finishPromise_reject(t),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function Di(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}n.ByteLengthQueuingStrategy=gr,n.CountQueuingStrategy=_r,n.ReadableByteStreamController=we,n.ReadableStream=U,n.ReadableStreamBYOBReader=Fe,n.ReadableStreamBYOBRequest=je,n.ReadableStreamDefaultController=Re,n.ReadableStreamDefaultReader=Be,n.TransformStream=wr,n.TransformStreamDefaultController=ze,n.WritableStream=We,n.WritableStreamDefaultController=lt,n.WritableStreamDefaultWriter=Se})});var js=x(()=>{"use strict";if(!globalThis.ReadableStream)try{let n=require("node:process"),{emitWarning:r}=n;try{n.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),n.emitWarning=r}catch(o){throw n.emitWarning=r,o}}catch{Object.assign(globalThis,$s())}try{let{Blob:n}=require("buffer");n&&!n.prototype.stream&&(n.prototype.stream=function(o){let s=0,a=this;return new ReadableStream({type:"bytes",async pull(u){let y=await a.slice(s,Math.min(a.size,s+65536)).arrayBuffer();s+=y.byteLength,u.enqueue(new Uint8Array(y)),s===a.size&&u.close()}})})}catch{}});async function*lo(n,r=!0){for(let o of n)if("stream"in o)yield*o.stream();else if(ArrayBuffer.isView(o))if(r){let s=o.byteOffset,a=o.byteOffset+o.byteLength;for(;s!==a;){let u=Math.min(a-s,Ns),f=o.buffer.slice(s,s+u);s+=f.byteLength,yield new Uint8Array(f)}}else yield o;else{let s=0,a=o;for(;s!==a.size;){let f=await a.slice(s,Math.min(a.size,s+Ns)).arrayBuffer();s+=f.byteLength,yield new Uint8Array(f)}}}var Dd,Ns,Us,Yc,Pe,Nt=qt(()=>{"use strict";Dd=Ce(js(),1);/*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> */Ns=65536;Us=class uo{#e=[];#t="";#r=0;#n="transparent";constructor(r=[],o={}){if(typeof r!="object"||r===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof r[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof o!="object"&&typeof o!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");o===null&&(o={});let s=new TextEncoder;for(let u of r){let f;ArrayBuffer.isView(u)?f=new Uint8Array(u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)):u instanceof ArrayBuffer?f=new Uint8Array(u.slice(0)):u instanceof uo?f=u:f=s.encode(`${u}`),this.#r+=ArrayBuffer.isView(f)?f.byteLength:f.size,this.#e.push(f)}this.#n=`${o.endings===void 0?"transparent":o.endings}`;let a=o.type===void 0?"":String(o.type);this.#t=/^[\x20-\x7E]*$/.test(a)?a:""}get size(){return this.#r}get type(){return this.#t}async text(){let r=new TextDecoder,o="";for await(let s of lo(this.#e,!1))o+=r.decode(s,{stream:!0});return o+=r.decode(),o}async arrayBuffer(){let r=new Uint8Array(this.size),o=0;for await(let s of lo(this.#e,!1))r.set(s,o),o+=s.length;return r.buffer}stream(){let r=lo(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(o){let s=await r.next();s.done?o.close():o.enqueue(s.value)},async cancel(){await r.return()}})}slice(r=0,o=this.size,s=""){let{size:a}=this,u=r<0?Math.max(a+r,0):Math.min(r,a),f=o<0?Math.max(a+o,0):Math.min(o,a),y=Math.max(f-u,0),m=this.#e,h=[],b=0;for(let E of m){if(b>=y)break;let P=ArrayBuffer.isView(E)?E.byteLength:E.size;if(u&&P<=u)u-=P,f-=P;else{let g;ArrayBuffer.isView(E)?(g=E.subarray(u,Math.min(P,f)),b+=g.byteLength):(g=E.slice(u,Math.min(P,f)),b+=g.size),f-=P,h.push(g),u=0}}let O=new uo([],{type:String(s).toLowerCase()});return O.#r=y,O.#e=h,O}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](r){return r&&typeof r=="object"&&typeof r.constructor=="function"&&(typeof r.stream=="function"||typeof r.arrayBuffer=="function")&&/^(Blob|File)$/.test(r[Symbol.toStringTag])}};Object.defineProperties(Us.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Yc=Us,Pe=Yc});var Qc,Kc,wt,co=qt(()=>{"use strict";Nt();Qc=class extends Pe{#e=0;#t="";constructor(r,o,s={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(r,s),s===null&&(s={});let a=s.lastModified===void 0?Date.now():Number(s.lastModified);Number.isNaN(a)||(this.#e=a),this.#t=String(o)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](r){return!!r&&r instanceof Pe&&/^(File)$/.test(r[Symbol.toStringTag])}},Kc=Qc,wt=Kc});function Vs(n,r=Pe){var o=`${Hs()}${Hs()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),s=[],a=`--${o}\r
Content-Disposition: form-data; name="`;return n.forEach((u,f)=>typeof u=="string"?s.push(a+fo(f)+`"\r
\r
${u.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):s.push(a+fo(f)+`"; filename="${fo(u.name,1)}"\r
Content-Type: ${u.type||"application/octet-stream"}\r
\r
`,u,`\r
`)),s.push(`--${o}--`),new r(s,{type:"multipart/form-data; boundary="+o})}var Ut,Jc,Zc,Hs,Xc,Gs,fo,et,tt,Gr=qt(()=>{"use strict";Nt();co();/*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> */({toStringTag:Ut,iterator:Jc,hasInstance:Zc}=Symbol),Hs=Math.random,Xc="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Gs=(n,r,o)=>(n+="",/^(Blob|File)$/.test(r&&r[Ut])?[(o=o!==void 0?o+"":r[Ut]=="File"?r.name:"blob",n),r.name!==o||r[Ut]=="blob"?new wt([r],o,r):r]:[n,r+""]),fo=(n,r)=>(r?n:n.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),et=(n,r,o)=>{if(r.length<o)throw new TypeError(`Failed to execute '${n}' on 'FormData': ${o} arguments required, but only ${r.length} present.`)},tt=class{#e=[];constructor(...r){if(r.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Ut](){return"FormData"}[Jc](){return this.entries()}static[Zc](r){return r&&typeof r=="object"&&r[Ut]==="FormData"&&!Xc.some(o=>typeof r[o]!="function")}append(...r){et("append",arguments,2),this.#e.push(Gs(...r))}delete(r){et("delete",arguments,1),r+="",this.#e=this.#e.filter(([o])=>o!==r)}get(r){et("get",arguments,1),r+="";for(var o=this.#e,s=o.length,a=0;a<s;a++)if(o[a][0]===r)return o[a][1];return null}getAll(r,o){return et("getAll",arguments,1),o=[],r+="",this.#e.forEach(s=>s[0]===r&&o.push(s[1])),o}has(r){return et("has",arguments,1),r+="",this.#e.some(o=>o[0]===r)}forEach(r,o){et("forEach",arguments,1);for(var[s,a]of this)r.call(o,a,s,this)}set(...r){et("set",arguments,2);var o=[],s=!0;r=Gs(...r),this.#e.forEach(a=>{a[0]===r[0]?s&&(s=!o.push(r)):o.push(a)}),s&&o.push(r),this.#e=o}*entries(){yield*this.#e}*keys(){for(var[r]of this)yield r}*values(){for(var[,r]of this)yield r}}});var Zs=x((Gd,Js)=>{"use strict";/*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> */if(!globalThis.DOMException)try{let{MessageChannel:n}=require("worker_threads"),r=new n().port1,o=new ArrayBuffer;r.postMessage(o,[o,o])}catch(n){n.constructor.name==="DOMException"&&(globalThis.DOMException=n.constructor)}Js.exports=globalThis.DOMException});var Yr,ef,Qd,po=qt(()=>{"use strict";Yr=require("node:fs"),ef=Ce(Zs(),1);co();Nt();({stat:Qd}=Yr.promises)});var ea={};Fi(ea,{toFormData:()=>lf});function af(n){let r=n.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!r)return;let o=r[2]||r[3]||"",s=o.slice(o.lastIndexOf("\\")+1);return s=s.replace(/%22/g,'"'),s=s.replace(/&#(\d{4});/g,(a,u)=>String.fromCharCode(u)),s}async function lf(n,r){if(!/multipart/i.test(r))throw new TypeError("Failed to fetch");let o=r.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!o)throw new TypeError("no or bad content-type header, no multipart boundary");let s=new mo(o[1]||o[2]),a,u,f,y,m,h,b=[],O=new tt,E=R=>{f+=w.decode(R,{stream:!0})},P=R=>{b.push(R)},g=()=>{let R=new wt(b,h,{type:m});O.append(y,R)},v=()=>{O.append(y,f)},w=new TextDecoder("utf-8");w.decode(),s.onPartBegin=function(){s.onPartData=E,s.onPartEnd=v,a="",u="",f="",y="",m="",h=null,b.length=0},s.onHeaderField=function(R){a+=w.decode(R,{stream:!0})},s.onHeaderValue=function(R){u+=w.decode(R,{stream:!0})},s.onHeaderEnd=function(){if(u+=w.decode(),a=a.toLowerCase(),a==="content-disposition"){let R=u.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);R&&(y=R[2]||R[3]||""),h=af(u),h&&(s.onPartData=P,s.onPartEnd=g)}else a==="content-type"&&(m=u);u="",a=""};for await(let R of n)s.write(R);return s.end(),O}var me,L,Xs,$e,Qr,Kr,tf,Gt,rf,nf,of,sf,rt,mo,ta=qt(()=>{"use strict";po();Gr();me=0,L={START_BOUNDARY:me++,HEADER_FIELD_START:me++,HEADER_FIELD:me++,HEADER_VALUE_START:me++,HEADER_VALUE:me++,HEADER_VALUE_ALMOST_DONE:me++,HEADERS_ALMOST_DONE:me++,PART_DATA_START:me++,PART_DATA:me++,END:me++},Xs=1,$e={PART_BOUNDARY:Xs,LAST_BOUNDARY:Xs*=2},Qr=10,Kr=13,tf=32,Gt=45,rf=58,nf=97,of=122,sf=n=>n|32,rt=()=>{},mo=class{constructor(r){this.index=0,this.flags=0,this.onHeaderEnd=rt,this.onHeaderField=rt,this.onHeadersEnd=rt,this.onHeaderValue=rt,this.onPartBegin=rt,this.onPartData=rt,this.onPartEnd=rt,this.boundaryChars={},r=`\r
--`+r;let o=new Uint8Array(r.length);for(let s=0;s<r.length;s++)o[s]=r.charCodeAt(s),this.boundaryChars[o[s]]=!0;this.boundary=o,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=L.START_BOUNDARY}write(r){let o=0,s=r.length,a=this.index,{lookbehind:u,boundary:f,boundaryChars:y,index:m,state:h,flags:b}=this,O=this.boundary.length,E=O-1,P=r.length,g,v,w=B=>{this[B+"Mark"]=o},R=B=>{delete this[B+"Mark"]},D=(B,F,z,ke)=>{(F===void 0||F!==z)&&this[B](ke&&ke.subarray(F,z))},$=(B,F)=>{let z=B+"Mark";z in this&&(F?(D(B,this[z],o,r),delete this[z]):(D(B,this[z],r.length,r),this[z]=0))};for(o=0;o<s;o++)switch(g=r[o],h){case L.START_BOUNDARY:if(m===f.length-2){if(g===Gt)b|=$e.LAST_BOUNDARY;else if(g!==Kr)return;m++;break}else if(m-1===f.length-2){if(b&$e.LAST_BOUNDARY&&g===Gt)h=L.END,b=0;else if(!(b&$e.LAST_BOUNDARY)&&g===Qr)m=0,D("onPartBegin"),h=L.HEADER_FIELD_START;else return;break}g!==f[m+2]&&(m=-2),g===f[m+2]&&m++;break;case L.HEADER_FIELD_START:h=L.HEADER_FIELD,w("onHeaderField"),m=0;case L.HEADER_FIELD:if(g===Kr){R("onHeaderField"),h=L.HEADERS_ALMOST_DONE;break}if(m++,g===Gt)break;if(g===rf){if(m===1)return;$("onHeaderField",!0),h=L.HEADER_VALUE_START;break}if(v=sf(g),v<nf||v>of)return;break;case L.HEADER_VALUE_START:if(g===tf)break;w("onHeaderValue"),h=L.HEADER_VALUE;case L.HEADER_VALUE:g===Kr&&($("onHeaderValue",!0),D("onHeaderEnd"),h=L.HEADER_VALUE_ALMOST_DONE);break;case L.HEADER_VALUE_ALMOST_DONE:if(g!==Qr)return;h=L.HEADER_FIELD_START;break;case L.HEADERS_ALMOST_DONE:if(g!==Qr)return;D("onHeadersEnd"),h=L.PART_DATA_START;break;case L.PART_DATA_START:h=L.PART_DATA,w("onPartData");case L.PART_DATA:if(a=m,m===0){for(o+=E;o<P&&!(r[o]in y);)o+=O;o-=E,g=r[o]}if(m<f.length)f[m]===g?(m===0&&$("onPartData",!0),m++):m=0;else if(m===f.length)m++,g===Kr?b|=$e.PART_BOUNDARY:g===Gt?b|=$e.LAST_BOUNDARY:m=0;else if(m-1===f.length)if(b&$e.PART_BOUNDARY){if(m=0,g===Qr){b&=~$e.PART_BOUNDARY,D("onPartEnd"),D("onPartBegin"),h=L.HEADER_FIELD_START;break}}else b&$e.LAST_BOUNDARY&&g===Gt?(D("onPartEnd"),h=L.END,b=0):m=0;if(m>0)u[m-1]=g;else if(a>0){let B=new Uint8Array(u.buffer,u.byteOffset,u.byteLength);D("onPartData",0,a,B),a=0,w("onPartData"),o--}break;case L.END:break;default:throw new Error(`Unexpected state entered: ${h}`)}$("onHeaderField"),$("onHeaderValue"),$("onPartData"),this.index=m,this.state=h,this.flags=b}end(){if(this.state===L.HEADER_FIELD_START&&this.index===0||this.state===L.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==L.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var yf={};Fi(yf,{default:()=>bf});module.exports=hu(yf);var jt=require("obsidian");var Ft={apiKey:"",copyOutputToClipboard:!1,appendOutputToCurrentNote:!0,imageGenerationModel:"black-forest-labs/flux-dev",imageGenerationConfiguration:{prompt:'obsidian rock in the forest spelling out the words "Obsidian", canon pro photography, dynamic shot, 50mm',aspect_ratio:"1:1",prompt_strength:.8,num_outputs:1,num_inference_steps:50,guidance:3.5,output_format:"webp",output_quality:80,disable_safety_checker:!0}};var N=require("obsidian");var ji=Symbol.for("immer-nothing"),Mi=Symbol.for("immer-draftable"),X=Symbol.for("immer-state"),pu=process.env.NODE_ENV!=="production"?[function(n){return`The plugin for '${n}' has not been loaded into Immer. To enable the plugin, import and call \`enable${n}()\` when initializing your application.`},function(n){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${n}'`},"This object has been frozen and should not be mutated",function(n){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+n},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(n){return`'current' expects a draft, got: ${n}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(n){return`'original' expects a draft, got: ${n}`}]:[];function Y(n,...r){if(process.env.NODE_ENV!=="production"){let o=pu[n],s=typeof o=="function"?o.apply(null,r):o;throw new Error(`[Immer] ${s}`)}throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var bt=Object.getPrototypeOf;function yt(n){return!!n&&!!n[X]}function Je(n){return n?Ni(n)||Array.isArray(n)||!!n[Mi]||!!n.constructor?.[Mi]||Br(n)||Ir(n):!1}var mu=Object.prototype.constructor.toString();function Ni(n){if(!n||typeof n!="object")return!1;let r=bt(n);if(r===null)return!0;let o=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return o===Object?!0:typeof o=="function"&&Function.toString.call(o)===mu}function Ar(n,r){kr(n)===0?Reflect.ownKeys(n).forEach(o=>{r(o,n[o],n)}):n.forEach((o,s)=>r(s,o,n))}function kr(n){let r=n[X];return r?r.type_:Array.isArray(n)?1:Br(n)?2:Ir(n)?3:0}function Hn(n,r){return kr(n)===2?n.has(r):Object.prototype.hasOwnProperty.call(n,r)}function Ui(n,r,o){let s=kr(n);s===2?n.set(r,o):s===3?n.add(o):n[r]=o}function bu(n,r){return n===r?n!==0||1/n===1/r:n!==n&&r!==r}function Br(n){return n instanceof Map}function Ir(n){return n instanceof Set}function Ke(n){return n.copy_||n.base_}function Gn(n,r){if(Br(n))return new Map(n);if(Ir(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);if(!r&&Ni(n))return bt(n)?{...n}:Object.assign(Object.create(null),n);let o=Object.getOwnPropertyDescriptors(n);delete o[X];let s=Reflect.ownKeys(o);for(let a=0;a<s.length;a++){let u=s[a],f=o[u];f.writable===!1&&(f.writable=!0,f.configurable=!0),(f.get||f.set)&&(o[u]={configurable:!0,writable:!0,enumerable:f.enumerable,value:n[u]})}return Object.create(bt(n),o)}function Jn(n,r=!1){return Dr(n)||yt(n)||!Je(n)||(kr(n)>1&&(n.set=n.add=n.clear=n.delete=yu),Object.freeze(n),r&&Object.entries(n).forEach(([o,s])=>Jn(s,!0))),n}function yu(){Y(2)}function Dr(n){return Object.isFrozen(n)}var gu={};function Ze(n){let r=gu[n];return r||Y(0,n),r}var Wt;function Hi(){return Wt}function _u(n,r){return{drafts_:[],parent_:n,immer_:r,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Li(n,r){r&&(Ze("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=r)}function Vn(n){Yn(n),n.drafts_.forEach(wu),n.drafts_=null}function Yn(n){n===Wt&&(Wt=n.parent_)}function zi(n){return Wt=_u(Wt,n)}function wu(n){let r=n[X];r.type_===0||r.type_===1?r.revoke_():r.revoked_=!0}function xi(n,r){r.unfinalizedDrafts_=r.drafts_.length;let o=r.drafts_[0];return n!==void 0&&n!==o?(o[X].modified_&&(Vn(r),Y(4)),Je(n)&&(n=vr(r,n),r.parent_||Or(r,n)),r.patches_&&Ze("Patches").generateReplacementPatches_(o[X].base_,n,r.patches_,r.inversePatches_)):n=vr(r,o,[]),Vn(r),r.patches_&&r.patchListener_(r.patches_,r.inversePatches_),n!==ji?n:void 0}function vr(n,r,o){if(Dr(r))return r;let s=r[X];if(!s)return Ar(r,(a,u)=>$i(n,s,r,a,u,o)),r;if(s.scope_!==n)return r;if(!s.modified_)return Or(n,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;let a=s.copy_,u=a,f=!1;s.type_===3&&(u=new Set(a),a.clear(),f=!0),Ar(u,(y,m)=>$i(n,s,a,y,m,o,f)),Or(n,a,!1),o&&n.patches_&&Ze("Patches").generatePatches_(s,o,n.patches_,n.inversePatches_)}return s.copy_}function $i(n,r,o,s,a,u,f){if(process.env.NODE_ENV!=="production"&&a===o&&Y(5),yt(a)){let y=u&&r&&r.type_!==3&&!Hn(r.assigned_,s)?u.concat(s):void 0,m=vr(n,a,y);if(Ui(o,s,m),yt(m))n.canAutoFreeze_=!1;else return}else f&&o.add(a);if(Je(a)&&!Dr(a)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;vr(n,a),(!r||!r.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(o,s)&&Or(n,a)}}function Or(n,r,o=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&Jn(r,o)}function Su(n,r){let o=Array.isArray(n),s={type_:o?1:0,scope_:r?r.scope_:Hi(),modified_:!1,finalized_:!1,assigned_:{},parent_:r,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1},a=s,u=Zn;o&&(a=[s],u=Mt);let{revoke:f,proxy:y}=Proxy.revocable(a,u);return s.draft_=y,s.revoke_=f,y}var Zn={get(n,r){if(r===X)return n;let o=Ke(n);if(!Hn(o,r))return Ru(n,o,r);let s=o[r];return n.finalized_||!Je(s)?s:s===Nn(n.base_,r)?(Un(n),n.copy_[r]=Kn(s,n)):s},has(n,r){return r in Ke(n)},ownKeys(n){return Reflect.ownKeys(Ke(n))},set(n,r,o){let s=Gi(Ke(n),r);if(s?.set)return s.set.call(n.draft_,o),!0;if(!n.modified_){let a=Nn(Ke(n),r),u=a?.[X];if(u&&u.base_===o)return n.copy_[r]=o,n.assigned_[r]=!1,!0;if(bu(o,a)&&(o!==void 0||Hn(n.base_,r)))return!0;Un(n),Qn(n)}return n.copy_[r]===o&&(o!==void 0||r in n.copy_)||Number.isNaN(o)&&Number.isNaN(n.copy_[r])||(n.copy_[r]=o,n.assigned_[r]=!0),!0},deleteProperty(n,r){return Nn(n.base_,r)!==void 0||r in n.base_?(n.assigned_[r]=!1,Un(n),Qn(n)):delete n.assigned_[r],n.copy_&&delete n.copy_[r],!0},getOwnPropertyDescriptor(n,r){let o=Ke(n),s=Reflect.getOwnPropertyDescriptor(o,r);return s&&{writable:!0,configurable:n.type_!==1||r!=="length",enumerable:s.enumerable,value:o[r]}},defineProperty(){Y(11)},getPrototypeOf(n){return bt(n.base_)},setPrototypeOf(){Y(12)}},Mt={};Ar(Zn,(n,r)=>{Mt[n]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}});Mt.deleteProperty=function(n,r){return process.env.NODE_ENV!=="production"&&isNaN(parseInt(r))&&Y(13),Mt.set.call(this,n,r,void 0)};Mt.set=function(n,r,o){return process.env.NODE_ENV!=="production"&&r!=="length"&&isNaN(parseInt(r))&&Y(14),Zn.set.call(this,n[0],r,o,n[0])};function Nn(n,r){let o=n[X];return(o?Ke(o):n)[r]}function Ru(n,r,o){let s=Gi(r,o);return s?"value"in s?s.value:s.get?.call(n.draft_):void 0}function Gi(n,r){if(!(r in n))return;let o=bt(n);for(;o;){let s=Object.getOwnPropertyDescriptor(o,r);if(s)return s;o=bt(o)}}function Qn(n){n.modified_||(n.modified_=!0,n.parent_&&Qn(n.parent_))}function Un(n){n.copy_||(n.copy_=Gn(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var Tu=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(r,o,s)=>{if(typeof r=="function"&&typeof o!="function"){let u=o;o=r;let f=this;return function(m=u,...h){return f.produce(m,b=>o.call(this,b,...h))}}typeof o!="function"&&Y(6),s!==void 0&&typeof s!="function"&&Y(7);let a;if(Je(r)){let u=zi(this),f=Kn(r,void 0),y=!0;try{a=o(f),y=!1}finally{y?Vn(u):Yn(u)}return Li(u,s),xi(a,u)}else if(!r||typeof r!="object"){if(a=o(r),a===void 0&&(a=r),a===ji&&(a=void 0),this.autoFreeze_&&Jn(a,!0),s){let u=[],f=[];Ze("Patches").generateReplacementPatches_(r,a,u,f),s(u,f)}return a}else Y(1,r)},this.produceWithPatches=(r,o)=>{if(typeof r=="function")return(f,...y)=>this.produceWithPatches(f,m=>r(m,...y));let s,a;return[this.produce(r,o,(f,y)=>{s=f,a=y}),s,a]},typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof n?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){Je(n)||Y(8),yt(n)&&(n=Eu(n));let r=zi(this),o=Kn(n,void 0);return o[X].isManual_=!0,Yn(r),o}finishDraft(n,r){let o=n&&n[X];(!o||!o.isManual_)&&Y(9);let{scope_:s}=o;return Li(s,r),xi(void 0,s)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,r){let o;for(o=r.length-1;o>=0;o--){let a=r[o];if(a.path.length===0&&a.op==="replace"){n=a.value;break}}o>-1&&(r=r.slice(o+1));let s=Ze("Patches").applyPatches_;return yt(n)?s(n,r):this.produce(n,a=>s(a,r))}};function Kn(n,r){let o=Br(n)?Ze("MapSet").proxyMap_(n,r):Ir(n)?Ze("MapSet").proxySet_(n,r):Su(n,r);return(r?r.scope_:Hi()).drafts_.push(o),o}function Eu(n){return yt(n)||Y(10,n),Vi(n)}function Vi(n){if(!Je(n)||Dr(n))return n;let r=n[X],o;if(r){if(!r.modified_)return r.base_;r.finalized_=!0,o=Gn(n,r.scope_.immer_.useStrictShallowCopy_)}else o=Gn(n,!0);return Ar(o,(s,a)=>{Ui(o,s,Vi(a))}),r&&(r.finalized_=!1),o}var ee=new Tu,pe=ee.produce,wf=ee.produceWithPatches.bind(ee),Sf=ee.setAutoFreeze.bind(ee),Rf=ee.setUseStrictShallowCopy.bind(ee),Tf=ee.applyPatches.bind(ee),Ef=ee.createDraft.bind(ee),Cf=ee.finishDraft.bind(ee);var Yi="Replicate";var Au=`${Yi}:`,q=(n,r,...o)=>{let s=`${Au} ${n}`;switch(r){case"debug":console.debug(s,o);break;case"info":console.info(s,o);break;case"warn":console.warn(s,o);break;case"error":console.error(s,o);break;default:console.log(s,o)}};var Lt="Please configure the Replicate plugin to provide a valid Replicate.com API key",Qi="Please configure the Replicate plugin to provide an image generation model",Xn="Error while generating image(s) using Replicate.com";var qr=class extends N.PluginSettingTab{constructor(r,o){super(r,o),this.plugin=o}display(){let{containerEl:r}=this;r.empty();let o=new N.Setting(r);o.setName("General"),o.setHeading(),this.renderApiKey(r),this.renderCopyOutputToClipboard(r),this.renderAppendOutputToCurrentNote(r);let s=new N.Setting(r);s.setName("Image Generation"),s.setHeading(),this.renderImageGenerationModel(r),this.renderImageGenerationModelConfiguration(r),this.renderFollowButton(r),this.renderSupportHeader(r)}renderApiKey(r){new N.Setting(r).setName("Replicate.com API Key").addText(o=>{o.setPlaceholder("").setValue(this.plugin.settings.apiKey).onChange(async s=>{q("Replicate.com API Key set to: ","debug",s),this.plugin.settings=pe(this.plugin.settings,a=>{a.apiKey=s}),await this.plugin.saveSettings()})})}renderCopyOutputToClipboard(r){new N.Setting(r).setName("Copy the generated output to the clipboard").setDesc("If enabled, the generated output will be copied to the clipboard.").addToggle(o=>{o.setValue(this.plugin.settings.copyOutputToClipboard),o.onChange(async s=>{this.plugin.settings=pe(this.plugin.settings,a=>{a.copyOutputToClipboard=s}),await this.plugin.saveSettings()})})}renderAppendOutputToCurrentNote(r){new N.Setting(r).setName("Append the generated output to the current note").setDesc("If enabled, the generated output will be appended to the current note (if possibvle).").addToggle(o=>{o.setValue(this.plugin.settings.appendOutputToCurrentNote),o.onChange(async s=>{this.plugin.settings=pe(this.plugin.settings,a=>{a.appendOutputToCurrentNote=s}),await this.plugin.saveSettings()})})}renderImageGenerationModel(r){new N.Setting(r).setName("Image generation model").setDesc("The model that will be used to generate images.").addText(o=>{o.setPlaceholder("").setValue(this.plugin.settings.imageGenerationModel).onChange(async s=>{q("Image generation model set to: ","debug",s),this.plugin.settings=pe(this.plugin.settings,a=>{a.imageGenerationModel=s}),await this.plugin.saveSettings()})})}renderImageGenerationModelConfiguration(r){new N.Setting(r).setName("Image generation model configuration").setDesc("The image generation model configuration.").setClass("replicate-plugin-setting-image-generation-model-configuration").addTextArea(o=>{o.setPlaceholder("Valid JSON object").setValue(JSON.stringify(this.plugin.settings.imageGenerationConfiguration,null,2)).onChange((0,N.debounce)(async s=>{q("Image generation model configuration set to: ","debug",s);let a={};if(s.trim()==="")o.setValue(JSON.stringify(a,null,2));else try{a=JSON.parse(s)}catch(u){q("Invalid JSON for image generation model configuration","warn",u),new N.Notice("The Replicate.com image generation model configuration is not a valid JSON object. Please correct it.",5e3),a=s}this.plugin.settings=pe(this.plugin.settings,u=>{u.imageGenerationConfiguration=a}),await this.plugin.saveSettings()},500,!0))})}renderFollowButton(r){new N.Setting(r).setName("Follow me on X").setDesc("@dSebastien").addButton(o=>{o.setCta(),o.setButtonText("Follow me on X").onClick(()=>{window.open("https://x.com/dSebastien")})})}renderSupportHeader(r){new N.Setting(r).setName("Support").setHeading();let o=new DocumentFragment;o.createDiv({text:"Buy me a coffee to support the development of this plugin \u2764\uFE0F"}),new N.Setting(r).setDesc(o),this.renderBuyMeACoffeeBadge(r),r.createDiv().classList.add("support-header-margin")}renderBuyMeACoffeeBadge(r,o=175){let a=r.createEl("a",{href:"https://www.buymeacoffee.com/dsebastien"}).createEl("img");a.src="https://github.com/dsebastien/obsidian-plugin-template/raw/main/apps/plugin/src/assets/buy-me-a-coffee.png",a.alt="Buy me a coffee",a.width=o}};var Xe=require("obsidian");var zt=n=>n.apiKey.trim()!=="";var Ki=n=>n.imageGenerationModel.trim()!=="";var Ms=Ce(Ws()),Ls=n=>(q("Creating Replicate.com API client","debug"),new Ms.default({auth:n,userAgent:"Obsidian Replicate"}));var ao=async(n,r,o)=>{if(!zt(r)){q("Cannot generate images because the Replicate.com API Key has not been configured","warn"),new Xe.Notice(Lt,5e3);return}if(!Ki){q("Cannot generate images because no image generation model has been configured","warn"),new Xe.Notice(Qi,5e3);return}let s=Ls(r.apiKey);q("Generating images for prompt: ","debug",n),new Xe.Notice(`Generating image(s) for with following prompt: [${n}] using the following model [${r.imageGenerationModel}]`,5e3);let a={input:{...r.imageGenerationConfiguration,prompt:n},progress:u=>{q("Image generation progress: ","debug",u)}};try{q("Sending image generation request to Replicate.com. Configuration: ","debug",a);let u=await s.run(r.imageGenerationModel,a);if(!u){q("Failed to generate images using Replicate.com","warn"),new Xe.Notice(Xn,5e3);return}let f="";if(Array.isArray(u)?f=u.join(`
`):f=JSON.stringify(u),q("Image generation result: ","debug",f),new Xe.Notice(`Successfully generated image(s) using Replicate.com: [${f}]`,5e3),r.copyOutputToClipboard){q("Copying the output to the clipboard","debug");try{await navigator.clipboard.writeText(f)}catch{}}if(r.appendOutputToCurrentNote){if(q("Trying to append the output to the current note","debug"),!o.workspace.activeEditor||!o.workspace.activeEditor.editor){q("No active editor found to append the output to","warn");return}let y=o.workspace.activeEditor.editor,m=y.getCursor(),h=y.getSelection(),b="";if(h&&h.trim()!==""&&(b=`
`),b+=`Images generated using Replicate.com with the following prompt: \`${n}\`

`,Array.isArray(u))for(let O of u)b+=`![](${O})
`;else b+=`![](${u})
`;q("Editor found. Appending the output to the current cursor position","debug"),h&&h===n?y.replaceSelection(b):y.replaceRange(b,m)}}catch(u){q("Error while generating image(s) using Replicate.com","warn",u),new Xe.Notice(`${Xn}: [${u}]`,5e3);return}};var $t=require("obsidian"),Nr=class extends $t.Modal{constructor(o,s){super(o);this.onSubmit=s;this.result="",this.modalEl.addClass("replicate-plugin-prompt-modal")}onOpen(){let{contentEl:o}=this;o.createEl("h1",{text:"Generate image(s) using Replicate.com"});let s;new $t.Setting(o).setName("Prompt to use:").addTextArea(a=>{a.onChange(u=>{this.result=u}),a.setPlaceholder("Enter the prompt to use"),a.inputEl.addEventListener("keydown",u=>{if(u.ctrlKey&&u.key==="Enter"){if(u.preventDefault(),!s)return;s.click()}})}),new $t.Setting(o).addButton(a=>{s=a.buttonEl,a.setButtonText("Submit").setCta().onClick(()=>{this.close(),this.onSubmit(this.result)})})}onClose(){let{contentEl:o}=this;o.empty()}};var Ur=class extends jt.Plugin{constructor(){super(...arguments);this.settings=pe(Ft,()=>Ft)}async onload(){q("Initializing","debug"),await this.loadSettings(),this.addSettingTab(new qr(this.app,this)),zt(this.settings)||new jt.Notice(Lt,5e3),this.addCommand({id:"generate-image-using-replicate",name:"Generate image(s)",callback:async()=>{await this.generateImages()}}),this.registerEvent(this.app.workspace.on("editor-menu",(o,s)=>{o.addSeparator(),o.addItem(a=>{a.setIcon("image"),a.setTitle("Generate image(s) using Replicate.com").onClick(async()=>{await this.generateImages(s)})})}))}onunload(){}async generateImages(o){if(q("Generate image(s) using Replicate.com","debug"),!zt(this.settings)){new jt.Notice(Lt,5e3);return}let s=o?o.getSelection():"";if(this.app.workspace.activeEditor&&this.app.workspace.activeEditor.editor&&(s=this.app.workspace.activeEditor.editor.getSelection()),!s||s.trim()===""){new Nr(this.app,async a=>{await ao(a,this.settings,this.app)}).open();return}await ao(s,this.settings,this.app)}async loadSettings(){q("Loading settings","debug");let o=await this.loadData();if(!o){q("Using default settings","debug"),o=pe(Ft,()=>Ft);return}let s=!1;this.settings=pe(this.settings,a=>{o.apiKey?a.apiKey=o.apiKey:(q("The loaded settings miss the [apiKey] property","debug"),s=!0),o.copyOutputToClipboard?a.copyOutputToClipboard=o.copyOutputToClipboard:(q("The loaded settings miss the [copyOutputToClipboard] property","debug"),s=!0),o.appendOutputToCurrentNote?a.appendOutputToCurrentNote=o.appendOutputToCurrentNote:(q("The loaded settings miss the [appendOutputToCurrentNote] property","debug"),s=!0),o.imageGenerationModel?a.imageGenerationModel=o.imageGenerationModel:(q("The loaded settings miss the [imageGenerationModel] property","debug"),s=!0),o.imageGenerationConfiguration?a.imageGenerationConfiguration=o.imageGenerationConfiguration:(q("The loaded settings miss the [imageGenerationConfiguration] property","debug"),s=!0)}),q("Settings loaded","debug",o),s&&this.saveSettings()}async saveSettings(){q("Saving settings","debug",this.settings),await this.saveData(this.settings),q("Settings saved","debug",this.settings)}};var ba=Ce(require("node:http"),1),ya=Ce(require("node:https"),1),nt=Ce(require("node:zlib"),1),re=Ce(require("node:stream"),1),Qt=require("node:buffer");function Vc(n){if(!/^data:/i.test(n))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');n=n.replace(/\r?\n/g,"");let r=n.indexOf(",");if(r===-1||r<=4)throw new TypeError("malformed data: URI");let o=n.substring(5,r).split(";"),s="",a=!1,u=o[0]||"text/plain",f=u;for(let b=1;b<o.length;b++)o[b]==="base64"?a=!0:o[b]&&(f+=`;${o[b]}`,o[b].indexOf("charset=")===0&&(s=o[b].substring(8)));!o[0]&&!s.length&&(f+=";charset=US-ASCII",s="US-ASCII");let y=a?"base64":"ascii",m=unescape(n.substring(r+1)),h=Buffer.from(m,y);return h.type=u,h.typeFull=f,h.charset=s,h}var zs=Vc;var se=Ce(require("node:stream"),1),ve=require("node:util"),te=require("node:buffer");Nt();Gr();var Ae=class extends Error{constructor(r,o){super(r),Error.captureStackTrace(this,this.constructor),this.type=o}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var Q=class extends Ae{constructor(r,o,s){super(r,o),s&&(this.code=this.errno=s.code,this.erroredSysCall=s.syscall)}};var Vr=Symbol.toStringTag,ho=n=>typeof n=="object"&&typeof n.append=="function"&&typeof n.delete=="function"&&typeof n.get=="function"&&typeof n.getAll=="function"&&typeof n.has=="function"&&typeof n.set=="function"&&typeof n.sort=="function"&&n[Vr]==="URLSearchParams",Ht=n=>n&&typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&typeof n.constructor=="function"&&/^(Blob|File)$/.test(n[Vr]),Ys=n=>typeof n=="object"&&(n[Vr]==="AbortSignal"||n[Vr]==="EventTarget"),Qs=(n,r)=>{let o=new URL(r).hostname,s=new URL(n).hostname;return o===s||o.endsWith(`.${s}`)},Ks=(n,r)=>{let o=new URL(r).protocol,s=new URL(n).protocol;return o===s};var uf=(0,ve.promisify)(se.default.pipeline),K=Symbol("Body internals"),be=class{constructor(r,{size:o=0}={}){let s=null;r===null?r=null:ho(r)?r=te.Buffer.from(r.toString()):Ht(r)||te.Buffer.isBuffer(r)||(ve.types.isAnyArrayBuffer(r)?r=te.Buffer.from(r):ArrayBuffer.isView(r)?r=te.Buffer.from(r.buffer,r.byteOffset,r.byteLength):r instanceof se.default||(r instanceof tt?(r=Vs(r),s=r.type.split("=")[1]):r=te.Buffer.from(String(r))));let a=r;te.Buffer.isBuffer(r)?a=se.default.Readable.from(r):Ht(r)&&(a=se.default.Readable.from(r.stream())),this[K]={body:r,stream:a,boundary:s,disturbed:!1,error:null},this.size=o,r instanceof se.default&&r.on("error",u=>{let f=u instanceof Ae?u:new Q(`Invalid response body while trying to fetch ${this.url}: ${u.message}`,"system",u);this[K].error=f})}get body(){return this[K].stream}get bodyUsed(){return this[K].disturbed}async arrayBuffer(){let{buffer:r,byteOffset:o,byteLength:s}=await bo(this);return r.slice(o,o+s)}async formData(){let r=this.headers.get("content-type");if(r.startsWith("application/x-www-form-urlencoded")){let s=new tt,a=new URLSearchParams(await this.text());for(let[u,f]of a)s.append(u,f);return s}let{toFormData:o}=await Promise.resolve().then(()=>(ta(),ea));return o(this.body,r)}async blob(){let r=this.headers&&this.headers.get("content-type")||this[K].body&&this[K].body.type||"",o=await this.arrayBuffer();return new Pe([o],{type:r})}async json(){let r=await this.text();return JSON.parse(r)}async text(){let r=await bo(this);return new TextDecoder().decode(r)}buffer(){return bo(this)}};be.prototype.buffer=(0,ve.deprecate)(be.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(be.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,ve.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function bo(n){if(n[K].disturbed)throw new TypeError(`body used already for: ${n.url}`);if(n[K].disturbed=!0,n[K].error)throw n[K].error;let{body:r}=n;if(r===null)return te.Buffer.alloc(0);if(!(r instanceof se.default))return te.Buffer.alloc(0);let o=[],s=0;try{for await(let a of r){if(n.size>0&&s+a.length>n.size){let u=new Q(`content size at ${n.url} over limit: ${n.size}`,"max-size");throw r.destroy(u),u}s+=a.length,o.push(a)}}catch(a){throw a instanceof Ae?a:new Q(`Invalid response body while trying to fetch ${n.url}: ${a.message}`,"system",a)}if(r.readableEnded===!0||r._readableState.ended===!0)try{return o.every(a=>typeof a=="string")?te.Buffer.from(o.join("")):te.Buffer.concat(o,s)}catch(a){throw new Q(`Could not create Buffer from response body for ${n.url}: ${a.message}`,"system",a)}else throw new Q(`Premature close of server response while trying to fetch ${n.url}`)}var St=(n,r)=>{let o,s,{body:a}=n[K];if(n.bodyUsed)throw new Error("cannot clone body after it is used");return a instanceof se.default&&typeof a.getBoundary!="function"&&(o=new se.PassThrough({highWaterMark:r}),s=new se.PassThrough({highWaterMark:r}),a.pipe(o),a.pipe(s),n[K].stream=o,a=s),a},cf=(0,ve.deprecate)(n=>n.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Jr=(n,r)=>n===null?null:typeof n=="string"?"text/plain;charset=UTF-8":ho(n)?"application/x-www-form-urlencoded;charset=UTF-8":Ht(n)?n.type||null:te.Buffer.isBuffer(n)||ve.types.isAnyArrayBuffer(n)||ArrayBuffer.isView(n)?null:n instanceof tt?`multipart/form-data; boundary=${r[K].boundary}`:n&&typeof n.getBoundary=="function"?`multipart/form-data;boundary=${cf(n)}`:n instanceof se.default?null:"text/plain;charset=UTF-8",ra=n=>{let{body:r}=n[K];return r===null?0:Ht(r)?r.size:te.Buffer.isBuffer(r)?r.length:r&&typeof r.getLengthSync=="function"&&r.hasKnownLength&&r.hasKnownLength()?r.getLengthSync():null},na=async(n,{body:r})=>{r===null?n.end():await uf(r,n)};var yo=require("node:util"),Vt=Ce(require("node:http"),1),Zr=typeof Vt.default.validateHeaderName=="function"?Vt.default.validateHeaderName:n=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(n)){let r=new TypeError(`Header name must be a valid HTTP token [${n}]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),r}},go=typeof Vt.default.validateHeaderValue=="function"?Vt.default.validateHeaderValue:(n,r)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(r)){let o=new TypeError(`Invalid character in header content ["${n}"]`);throw Object.defineProperty(o,"code",{value:"ERR_INVALID_CHAR"}),o}},G=class n extends URLSearchParams{constructor(r){let o=[];if(r instanceof n){let s=r.raw();for(let[a,u]of Object.entries(s))o.push(...u.map(f=>[a,f]))}else if(r!=null)if(typeof r=="object"&&!yo.types.isBoxedPrimitive(r)){let s=r[Symbol.iterator];if(s==null)o.push(...Object.entries(r));else{if(typeof s!="function")throw new TypeError("Header pairs must be iterable");o=[...r].map(a=>{if(typeof a!="object"||yo.types.isBoxedPrimitive(a))throw new TypeError("Each header pair must be an iterable object");return[...a]}).map(a=>{if(a.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...a]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return o=o.length>0?o.map(([s,a])=>(Zr(s),go(s,String(a)),[String(s).toLowerCase(),String(a)])):void 0,super(o),new Proxy(this,{get(s,a,u){switch(a){case"append":case"set":return(f,y)=>(Zr(f),go(f,String(y)),URLSearchParams.prototype[a].call(s,String(f).toLowerCase(),String(y)));case"delete":case"has":case"getAll":return f=>(Zr(f),URLSearchParams.prototype[a].call(s,String(f).toLowerCase()));case"keys":return()=>(s.sort(),new Set(URLSearchParams.prototype.keys.call(s)).keys());default:return Reflect.get(s,a,u)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(r){let o=this.getAll(r);if(o.length===0)return null;let s=o.join(", ");return/^content-encoding$/i.test(r)&&(s=s.toLowerCase()),s}forEach(r,o=void 0){for(let s of this.keys())Reflect.apply(r,o,[this.get(s),s,this])}*values(){for(let r of this.keys())yield this.get(r)}*entries(){for(let r of this.keys())yield[r,this.get(r)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((r,o)=>(r[o]=this.getAll(o),r),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((r,o)=>{let s=this.getAll(o);return o==="host"?r[o]=s[0]:r[o]=s.length>1?s:s[0],r},{})}};Object.defineProperties(G.prototype,["get","entries","forEach","values"].reduce((n,r)=>(n[r]={enumerable:!0},n),{}));function oa(n=[]){return new G(n.reduce((r,o,s,a)=>(s%2===0&&r.push(a.slice(s,s+2)),r),[]).filter(([r,o])=>{try{return Zr(r),go(r,String(o)),!0}catch{return!1}}))}var ff=new Set([301,302,303,307,308]),Xr=n=>ff.has(n);var fe=Symbol("Response internals"),J=class n extends be{constructor(r=null,o={}){super(r,o);let s=o.status!=null?o.status:200,a=new G(o.headers);if(r!==null&&!a.has("Content-Type")){let u=Jr(r,this);u&&a.append("Content-Type",u)}this[fe]={type:"default",url:o.url,status:s,statusText:o.statusText||"",headers:a,counter:o.counter,highWaterMark:o.highWaterMark}}get type(){return this[fe].type}get url(){return this[fe].url||""}get status(){return this[fe].status}get ok(){return this[fe].status>=200&&this[fe].status<300}get redirected(){return this[fe].counter>0}get statusText(){return this[fe].statusText}get headers(){return this[fe].headers}get highWaterMark(){return this[fe].highWaterMark}clone(){return new n(St(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(r,o=302){if(!Xr(o))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new n(null,{headers:{location:new URL(r).toString()},status:o})}static error(){let r=new n(null,{status:0,statusText:""});return r[fe].type="error",r}static json(r=void 0,o={}){let s=JSON.stringify(r);if(s===void 0)throw new TypeError("data is not JSON serializable");let a=new G(o&&o.headers);return a.has("content-type")||a.set("content-type","application/json"),new n(s,{...o,headers:a})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(J.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var ha=require("node:url"),pa=require("node:util");var ia=n=>{if(n.search)return n.search;let r=n.href.length-1,o=n.hash||(n.href[r]==="#"?"#":"");return n.href[r-o.length]==="?"?"?":""};var aa=require("node:net");function sa(n,r=!1){return n==null||(n=new URL(n),/^(about|blob|data):$/.test(n.protocol))?"no-referrer":(n.username="",n.password="",n.hash="",r&&(n.pathname="",n.search=""),n)}var la=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),ua="strict-origin-when-cross-origin";function ca(n){if(!la.has(n))throw new TypeError(`Invalid referrerPolicy: ${n}`);return n}function df(n){if(/^(http|ws)s:$/.test(n.protocol))return!0;let r=n.host.replace(/(^\[)|(]$)/g,""),o=(0,aa.isIP)(r);return o===4&&/^127\./.test(r)||o===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(r)?!0:n.host==="localhost"||n.host.endsWith(".localhost")?!1:n.protocol==="file:"}function Rt(n){return/^about:(blank|srcdoc)$/.test(n)||n.protocol==="data:"||/^(blob|filesystem):$/.test(n.protocol)?!0:df(n)}function fa(n,{referrerURLCallback:r,referrerOriginCallback:o}={}){if(n.referrer==="no-referrer"||n.referrerPolicy==="")return null;let s=n.referrerPolicy;if(n.referrer==="about:client")return"no-referrer";let a=n.referrer,u=sa(a),f=sa(a,!0);u.toString().length>4096&&(u=f),r&&(u=r(u)),o&&(f=o(f));let y=new URL(n.url);switch(s){case"no-referrer":return"no-referrer";case"origin":return f;case"unsafe-url":return u;case"strict-origin":return Rt(u)&&!Rt(y)?"no-referrer":f.toString();case"strict-origin-when-cross-origin":return u.origin===y.origin?u:Rt(u)&&!Rt(y)?"no-referrer":f;case"same-origin":return u.origin===y.origin?u:"no-referrer";case"origin-when-cross-origin":return u.origin===y.origin?u:f;case"no-referrer-when-downgrade":return Rt(u)&&!Rt(y)?"no-referrer":u;default:throw new TypeError(`Invalid referrerPolicy: ${s}`)}}function da(n){let r=(n.get("referrer-policy")||"").split(/[,\s]+/),o="";for(let s of r)s&&la.has(s)&&(o=s);return o}var j=Symbol("Request internals"),Yt=n=>typeof n=="object"&&typeof n[j]=="object",hf=(0,pa.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),Oe=class n extends be{constructor(r,o={}){let s;if(Yt(r)?s=new URL(r.url):(s=new URL(r),r={}),s.username!==""||s.password!=="")throw new TypeError(`${s} is an url with embedded credentials.`);let a=o.method||r.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(a)&&(a=a.toUpperCase()),!Yt(o)&&"data"in o&&hf(),(o.body!=null||Yt(r)&&r.body!==null)&&(a==="GET"||a==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let u=o.body?o.body:Yt(r)&&r.body!==null?St(r):null;super(u,{size:o.size||r.size||0});let f=new G(o.headers||r.headers||{});if(u!==null&&!f.has("Content-Type")){let h=Jr(u,this);h&&f.set("Content-Type",h)}let y=Yt(r)?r.signal:null;if("signal"in o&&(y=o.signal),y!=null&&!Ys(y))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let m=o.referrer==null?r.referrer:o.referrer;if(m==="")m="no-referrer";else if(m){let h=new URL(m);m=/^about:(\/\/)?client$/.test(h)?"client":h}else m=void 0;this[j]={method:a,redirect:o.redirect||r.redirect||"follow",headers:f,parsedURL:s,signal:y,referrer:m},this.follow=o.follow===void 0?r.follow===void 0?20:r.follow:o.follow,this.compress=o.compress===void 0?r.compress===void 0?!0:r.compress:o.compress,this.counter=o.counter||r.counter||0,this.agent=o.agent||r.agent,this.highWaterMark=o.highWaterMark||r.highWaterMark||16384,this.insecureHTTPParser=o.insecureHTTPParser||r.insecureHTTPParser||!1,this.referrerPolicy=o.referrerPolicy||r.referrerPolicy||""}get method(){return this[j].method}get url(){return(0,ha.format)(this[j].parsedURL)}get headers(){return this[j].headers}get redirect(){return this[j].redirect}get signal(){return this[j].signal}get referrer(){if(this[j].referrer==="no-referrer")return"";if(this[j].referrer==="client")return"about:client";if(this[j].referrer)return this[j].referrer.toString()}get referrerPolicy(){return this[j].referrerPolicy}set referrerPolicy(r){this[j].referrerPolicy=ca(r)}clone(){return new n(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Oe.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var ma=n=>{let{parsedURL:r}=n[j],o=new G(n[j].headers);o.has("Accept")||o.set("Accept","*/*");let s=null;if(n.body===null&&/^(post|put)$/i.test(n.method)&&(s="0"),n.body!==null){let y=ra(n);typeof y=="number"&&!Number.isNaN(y)&&(s=String(y))}s&&o.set("Content-Length",s),n.referrerPolicy===""&&(n.referrerPolicy=ua),n.referrer&&n.referrer!=="no-referrer"?n[j].referrer=fa(n):n[j].referrer="no-referrer",n[j].referrer instanceof URL&&o.set("Referer",n.referrer),o.has("User-Agent")||o.set("User-Agent","node-fetch"),n.compress&&!o.has("Accept-Encoding")&&o.set("Accept-Encoding","gzip, deflate, br");let{agent:a}=n;typeof a=="function"&&(a=a(r));let u=ia(r),f={path:r.pathname+u,method:n.method,headers:o[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:n.insecureHTTPParser,agent:a};return{parsedURL:r,options:f}};var en=class extends Ae{constructor(r,o="aborted"){super(r,o)}};Gr();po();var pf=new Set(["data:","http:","https:"]);async function tn(n,r){return new Promise((o,s)=>{let a=new Oe(n,r),{parsedURL:u,options:f}=ma(a);if(!pf.has(u.protocol))throw new TypeError(`node-fetch cannot load ${n}. URL scheme "${u.protocol.replace(/:$/,"")}" is not supported.`);if(u.protocol==="data:"){let g=zs(a.url),v=new J(g,{headers:{"Content-Type":g.typeFull}});o(v);return}let y=(u.protocol==="https:"?ya.default:ba.default).request,{signal:m}=a,h=null,b=()=>{let g=new en("The operation was aborted.");s(g),a.body&&a.body instanceof re.default.Readable&&a.body.destroy(g),!(!h||!h.body)&&h.body.emit("error",g)};if(m&&m.aborted){b();return}let O=()=>{b(),P()},E=y(u.toString(),f);m&&m.addEventListener("abort",O);let P=()=>{E.abort(),m&&m.removeEventListener("abort",O)};E.on("error",g=>{s(new Q(`request to ${a.url} failed, reason: ${g.message}`,"system",g)),P()}),mf(E,g=>{h&&h.body&&h.body.destroy(g)}),process.version<"v14"&&E.on("socket",g=>{let v;g.prependListener("end",()=>{v=g._eventsCount}),g.prependListener("close",w=>{if(h&&v<g._eventsCount&&!w){let R=new Error("Premature close");R.code="ERR_STREAM_PREMATURE_CLOSE",h.body.emit("error",R)}})}),E.on("response",g=>{E.setTimeout(0);let v=oa(g.rawHeaders);if(Xr(g.statusCode)){let B=v.get("Location"),F=null;try{F=B===null?null:new URL(B,a.url)}catch{if(a.redirect!=="manual"){s(new Q(`uri requested responds with an invalid redirect URL: ${B}`,"invalid-redirect")),P();return}}switch(a.redirect){case"error":s(new Q(`uri requested responds with a redirect, redirect mode is set to error: ${a.url}`,"no-redirect")),P();return;case"manual":break;case"follow":{if(F===null)break;if(a.counter>=a.follow){s(new Q(`maximum redirect reached at: ${a.url}`,"max-redirect")),P();return}let z={headers:new G(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:St(a),signal:a.signal,size:a.size,referrer:a.referrer,referrerPolicy:a.referrerPolicy};if(!Qs(a.url,F)||!Ks(a.url,F))for(let Tt of["authorization","www-authenticate","cookie","cookie2"])z.headers.delete(Tt);if(g.statusCode!==303&&a.body&&r.body instanceof re.default.Readable){s(new Q("Cannot follow redirect with body being a readable stream","unsupported-redirect")),P();return}(g.statusCode===303||(g.statusCode===301||g.statusCode===302)&&a.method==="POST")&&(z.method="GET",z.body=void 0,z.headers.delete("content-length"));let ke=da(v);ke&&(z.referrerPolicy=ke),o(tn(new Oe(F,z))),P();return}default:return s(new TypeError(`Redirect option '${a.redirect}' is not a valid value of RequestRedirect`))}}m&&g.once("end",()=>{m.removeEventListener("abort",O)});let w=(0,re.pipeline)(g,new re.PassThrough,B=>{B&&s(B)});process.version<"v12.10"&&g.on("aborted",O);let R={url:a.url,status:g.statusCode,statusText:g.statusMessage,headers:v,size:a.size,counter:a.counter,highWaterMark:a.highWaterMark},D=v.get("Content-Encoding");if(!a.compress||a.method==="HEAD"||D===null||g.statusCode===204||g.statusCode===304){h=new J(w,R),o(h);return}let $={flush:nt.default.Z_SYNC_FLUSH,finishFlush:nt.default.Z_SYNC_FLUSH};if(D==="gzip"||D==="x-gzip"){w=(0,re.pipeline)(w,nt.default.createGunzip($),B=>{B&&s(B)}),h=new J(w,R),o(h);return}if(D==="deflate"||D==="x-deflate"){let B=(0,re.pipeline)(g,new re.PassThrough,F=>{F&&s(F)});B.once("data",F=>{(F[0]&15)===8?w=(0,re.pipeline)(w,nt.default.createInflate(),z=>{z&&s(z)}):w=(0,re.pipeline)(w,nt.default.createInflateRaw(),z=>{z&&s(z)}),h=new J(w,R),o(h)}),B.once("end",()=>{h||(h=new J(w,R),o(h))});return}if(D==="br"){w=(0,re.pipeline)(w,nt.default.createBrotliDecompress(),B=>{B&&s(B)}),h=new J(w,R),o(h);return}h=new J(w,R),o(h)}),na(E,a).catch(s)})}function mf(n,r){let o=Qt.Buffer.from(`0\r
\r
`),s=!1,a=!1,u;n.on("response",f=>{let{headers:y}=f;s=y["transfer-encoding"]==="chunked"&&!y["content-length"]}),n.on("socket",f=>{let y=()=>{if(s&&!a){let h=new Error("Premature close");h.code="ERR_STREAM_PREMATURE_CLOSE",r(h)}},m=h=>{a=Qt.Buffer.compare(h.slice(-5),o)===0,!a&&u&&(a=Qt.Buffer.compare(u.slice(-3),o.slice(0,3))===0&&Qt.Buffer.compare(h.slice(-2),o.slice(3))===0),u=h};f.prependListener("close",y),f.on("data",m),n.on("close",()=>{f.removeListener("close",y),f.removeListener("data",m)})})}globalThis.fetch=tn;globalThis.Headers=G;globalThis.Request=Oe;globalThis.Response=J;var bf=Ur;

/* nosourcemap */